<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
			   xmlns:s="library://ns.adobe.com/flex/spark"
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   width="686" height="{this.parentApplication.stage.stageHeight-10}" backgroundColor="#BBE0F4" chromeColor="#5CACEE"
			   close="removeWindow()" cornerRadius="5"
			   horizontalCenter="center" skinClass="com.xyw.sys.custom.skin.CustomTitleWindow"
			   title="图片" verticalCenter="middle" >
	<fx:Script>
		<![CDATA[
			import mx.controls.Alert;
			import mx.events.CloseEvent;
			import mx.events.ResizeEvent;
			import mx.managers.CursorManager;
			import mx.managers.PopUpManager;
			[Bindable]
			public var imageSource:Object;
			public var oldx:Number;
			public var oldy:Number;
			
			public function init():void{
				this.setFocus();
				image2.source=imageSource;
				this.addEventListener(KeyboardEvent.KEY_DOWN,KeyboardListener);
			}
			
			private function KeyboardListener(event:KeyboardEvent):void{
				if(event.keyCode==Keyboard.ESCAPE){
					Alert.yesLabel = '是'; 
					Alert.noLabel = '否';
					Alert.show('确认关闭窗口？','系统提示',1|2,this,escEventHandle);
				}
			}
			
			private function escEventHandle(event:CloseEvent):void
			{
				if(event.detail == Alert.YES){
					this.removeWindow();
				} else {
					this.setFocus();
				}
			}
			
			public function mouseMove(event:MouseEvent):void{
				if(event.buttonDown){
					var x:Number=event.stageX-oldx;//移动的x坐标
					var y:Number=event.stageY-oldy;//移动的y坐标
					oldx=event.stageX;  //把当时的坐标 给oldx oldy
					oldy=event.stageY;
					image2.move(image2.x+x,image2.y+y); //move 是移动函数
				}
			}
			
			private function doMouseWheel(evt:MouseEvent):void {
				var tempMatrix:Matrix = image2.transform.matrix;
				if(evt.delta > 0){
					tempMatrix.scale(1.1, 1.1);	
				} else if(evt.delta < 0){
					tempMatrix.scale(0.9, 0.9);
				}
				image2.transform.matrix = tempMatrix;
			}
			
			private function mouseDown(event:MouseEvent):void{
				CursorManager.removeAllCursors();
				oldx=event.stageX; // 当鼠标按下时,就把当时的坐标 给oldx oldy
				oldy=event.stageY;
			}
			
			private function mouseUp(event:MouseEvent):void{
				CursorManager.removeAllCursors();
			}
			
			//恢复原装
			private function resetImage():void { 
				var tempMatrix:Matrix = image2.transform.matrix;
				tempMatrix.identity();
				image2.transform.matrix = tempMatrix;
			} 
			//放大
			private function toBig():void{
				var tempMatrix:Matrix = image2.transform.matrix;
				tempMatrix.scale(1.1, 1.1);
				image2.transform.matrix = tempMatrix;
			}
			//缩小
			private function toSmall():void{
				var tempMatrix:Matrix = image2.transform.matrix;
				tempMatrix. scale(0.9, 0.9);
				image2.transform.matrix = tempMatrix;
			}
			
			private function removeWindow():void
			{ 
				PopUpManager.removePopUp(this);
			}
		]]>
	</fx:Script>
	<s:VGroup>
		<s:HGroup>
			<s:Button label="放大" autoRepeat="true" click="toBig();" buttonDown="toBig();"/>
			<s:Button label="缩小" autoRepeat="true" click="toSmall();" buttonDown="toSmall();"/>
			<s:Button label="还原" click="resetImage();"/>
			<s:Button label="关闭" click="removeWindow();"/>
		</s:HGroup>
		<s:HGroup horizontalAlign="center" paddingLeft="4"
				  paddingRight="4" verticalCenter="middle">
			<mx:Canvas mouseWheel="doMouseWheel(event)" id="g3" width="676" height="640" horizontalScrollPolicy="off" verticalScrollPolicy="off">
				<s:Image id="image2" width="676" source="{imageSource}"
						 horizontalAlign="center"
						  mouseDown="mouseDown(event)"
						  mouseMove="mouseMove(event)"
						  mouseUp="mouseUp(event)"/> 
			</mx:Canvas>
		</s:HGroup>
	</s:VGroup>
</s:TitleWindow>
