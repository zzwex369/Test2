<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
			   xmlns:s="library://ns.adobe.com/flex/spark"
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   xmlns:component="com.xyw.sys.custom.component.*"
			   maxWidth="{this.parentApplication.stage.stageWidth-20}"
			   maxHeight="{this.parentApplication.stage.stageHeight-50}" backgroundColor="white"
			   chromeColor="#5CACEE" close="closeHandler()" cornerRadius="5" horizontalCenter="0"
			   title="幼儿园" creationComplete="creationCompleteHandler(event)">
	<fx:Declarations>
		<s:RemoteObject id="systemService" destination="systemService"
						endpoint="{this.parentApplication.contextRoot}/messagebroker/amf"
						showBusyCursor="true">
			<s:method name="getComboBoxData" result="getComboBoxDataHandler(event)"/>
		</s:RemoteObject>	
		<s:RemoteObject id="e705Service" destination="e705Service"
						endpoint="{this.parentApplication.contextRoot}/messagebroker/amf"
						showBusyCursor="true">
			<s:method name="saveE705" result="saveOrRenewE705Handler(event)"/>
			<s:method name="renewE705" result="saveOrRenewE705Handler(event)"/>
		</s:RemoteObject>	
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		.myLabel
		{
			paddingTop:4px;
			fontSize:12px;
		}
		mx|GridItem
		{
			horizontalAlign:left;
			verticalAlign:middle;
		}
		s|Label 
		{
			fontSize:12px;
		}
		mx|GridItem
		{
			horizontalAlign:left;
			verticalAlign:middle;
		}
		s|TextInput
		{
			fontFamily:微软雅黑;
		}
		s|Button
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomButtonSkin");
		}
		s|DropDownList
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomDropDownListSkin");
			selectionColor:#DDDDDD;
			rollOverColor:#EEEEEE;	
		}
		.must 
		{
			color:red;
			fontSize:20px;
			fontWeight:bold;
			paddingTop:5px;
		}
		
		.pf8
		{
			paddingLeft:8px;
		}
		.textInput{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomTextInputSkin");
		}  
	</fx:Style>
	<fx:Script>
		<![CDATA[
			import com.xyw.module.xtwh.model.E705;
			import com.xyw.module.xtwh.model.E705Request;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.custom.component.CustomRegex;
			import com.xyw.sys.model.ComboBoxDataRequest;
			
			import mx.binding.utils.ChangeWatcher;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			
			import spark.events.IndexChangeEvent;
			public var ve705:Object;
			public var modify:Boolean=false;
			private function closeHandler():void
			{
				var index:Object=this.owner;
				index.refrashPage();
				PopUpManager.removePopUp(this);
				
			}
			
			private function creationCompleteHandler(event:FlexEvent):void
			{
				CompMethod.getDefaultCode(E705_11);
				E705_05.city.enabled=false;
				E705_05.province.enabled=false;
				E705_05.country.addEventListener(IndexChangeEvent.CHANGE,selectChange);
				if(!modify)
				{
					this.title+="登记";
					initializeComboBox();
									
				}else
				{
					this.title+="修改";
					updateE705();				
				}
			}
			
			/**
			 *
			 */
			private function initializeComboBox():void
			{
				var comboBoxDataRequest:ComboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = false;
				comboBoxDataRequest.sql = "select t.s_01,t.s_02 from S301_10 t where t.S_05='1' " +
					"and t.S_04 ="+this.parentApplication.systemUser.userCode;
				comboBoxDataRequest.flag = "S301_10_02";
				this.systemService.getComboBoxData(comboBoxDataRequest);
			}
			
			/******************得到数据******************/
			private function getComboBoxDataHandler(event:ResultEvent):void
			{
				var comboBoxDataResponse:Object =  event.result;
				var flag:String = comboBoxDataResponse.flag;
				if(flag == "S301_10_02")
				{
					this.E705_12.dataProvider = comboBoxDataResponse.comboBoxDataList;
					this.E705_12.selectedIndex = 0;
				}
			}
			
			/**
			 *
			 */
			private function updateE705():void
			{
				E705_03.text=ve705.e70503;
				E705_06.text=ve705.e70506;
				E705_08.text=ve705.e70508;
				E705_09.text=ve705.e70509;
				E705_10.text=ve705.e70510;
				E705_12.text=ve705.e70512;
				E705_07.text=DateField.dateToString(ve705.e70507,'YYYY-MM-DD');
				E705_13.text=DateField.dateToString(ve705.e70513,'YYYY-MM-DD');
				CompMethod.setRadioButtonSelect(E705_02,ve705.e70502);
				E705_11.selectedIndex=CompMethod.getDropDownListSelectedIndex(E705_11.dataProvider,ve705.e70511);
			}
			
			/**
			 *
			 */
			private function selectChange(event:IndexChangeEvent):void
			{
				E705_06.text=E705_05.getAreaName();
			}
			
			private function save_clickHandler(event:MouseEvent):void
			{
				if(!E705_03.text)
				{
					Alert.show("请输入幼儿园名称","系统提示");
					return;
				}
				
				if(!E705_08.text)
				{
					Alert.show("请输入负责人","系统提示");
					return;
				}
				
				if(!CustomRegex.testRegExp(CustomRegex.CELLPHONE,E705_09))
				{
					Alert.show("请输入正确电话","系统提示");
					return;
				}
				
				
				if(!CompMethod.validateAreaCode(E705_05.getAreaCode(),'4113'))
				{
					Alert.show("行政地址选择到最下级","系统提示");
					return ;
				}
				
				if(!E705_06.text)
				{
					Alert.show("请输入幼儿园详细地址","系统提示");
					return;
				}
				
				if(!E705_12.text)
				{
					Alert.show("请输入录入人员","系统提示");
					return;
				}
				
				saveE705();
			}
			
			/**
			 *
			 */
			private function saveE705():void
			{
				save.enabled=false;
				var e705:E705=new E705();
				var e705Request:E705Request=new E705Request();
				e705.e70505=E705_05.getAreaCode();
				e705.e70511=E705_11.selectedItem.data;
				e705.e70503=StringUtil.trim(E705_03.text);
				e705.e70506=StringUtil.trim(E705_06.text);
				e705.e70508=StringUtil.trim(E705_08.text);
				e705.e70509=StringUtil.trim(E705_09.text);
				e705.e70510=StringUtil.trim(E705_10.text);
				e705.e70512=StringUtil.trim(E705_12.text);
				e705.e70507=DateField.stringToDate(E705_07.text,"YYYY-MM-DD");
				e705.e70513=DateField.stringToDate(E705_13.text,"YYYY-MM-DD");
				e705.e70502=CompMethod.getRadioButtonValue(E705_02);
				e705Request.e705=e705;
				if(modify)
				{
					e705.e70501=ve705.e70501;
					e705.e70504=ve705.e70504;
					e705Request.e705=e705;
					e705Service.renewE705(e705Request);	
				}else
					e705Service.saveE705(e705Request);
					
			}
			
			private function saveOrRenewE705Handler(event:ResultEvent):void{   
				var e705Response:Object =  event.result;
				if(!e705Response.state) {
					save.enabled=true;
					Alert.show(e705Response.errorMessage,"系统提示");
					return;
				}

				Alert.show(modify?"修改成功":"保存成功！","系统提示",1,this,
					function():void{
						closeHandler();
					});	
			}
			
			
			private function E705_05_creationCompleteHandler(event:FlexEvent):void
			{
				if(ve705)
					E705_05.setAreaCode(ve705.e70505);
				
			}
			
		]]>
	</fx:Script>
	
	
		<s:Scroller width="100%" height="100%" chromeColor="#ffffff" horizontalScrollPolicy="auto"
					verticalScrollPolicy="auto">
			<s:VGroup horizontalAlign="center" paddingTop="5" paddingLeft="10" paddingRight="10" paddingBottom="15">
				<s:VGroup>
					
				
				<mx:TabNavigator width="1250" chromeColor="#ffffff" creationPolicy="all">
					<s:NavigatorContent width="100%" label="儿童信息">
				<mx:Grid paddingLeft="10" paddingRight="10">
					<mx:GridRow>
						<mx:GridItem>
							<s:Label styleName="myLabel" text="幼儿园名称"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:TextInput id="E705_03" width="140" restrict="^0-9"/>
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" text="幼儿园类型"/>
						</mx:GridItem>
						
						<mx:GridItem >
							<s:HGroup verticalAlign="baseline" id="E705_02">
								<s:RadioButton label="入园" buttonMode="true" groupName="E705_02"
											   selected="true" value="1"/>
								<s:RadioButton label="在园" buttonMode="true" groupName="E705_02" value="2"/>
								<s:RadioButton label="托幼" buttonMode="true" groupName="E705_02" value="3"/>
							</s:HGroup>
							
						</mx:GridItem>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" text="负责人"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:TextInput id="E705_08" restrict="^0-9"/>
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" text="保健老师"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:TextInput id="E705_10" restrict="^0-9"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" text="电话"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:TextInput id="E705_09" restrict="0-9" prompt="仅支持手机号码" maxChars="11" />
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" text="登记日期"/>
						</mx:GridItem>
						
						<mx:GridItem>
							<component:CustomRangeDateField id="E705_07" isSelectNow="true"/>
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
					</mx:GridRow>
					
					<mx:GridRow>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" paddingLeft="2" text="行 政 地 址 "/>
						</mx:GridItem>
						<mx:GridItem colSpan="11">
							<component:AreaComboBoxVillageAuto id="E705_05" width="100%"
															   areaCode="{this.parentApplication.systemUser.areaCode}"
															   buttonMode="true" table="D201_MS"
															   creationComplete="E705_05_creationCompleteHandler(event)"/>
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
						
					</mx:GridRow>
					
					<mx:GridRow>
						
						<mx:GridItem>
							<s:Label styleName="myLabel" paddingLeft="2" text="详 细 地 址"/>
						</mx:GridItem>
						<mx:GridItem colSpan="11">
							<s:TextInput width="100%" id="E705_06"/>
							<s:Label text="*" styleName="must myLabel"/>
						</mx:GridItem>
						
						</mx:GridRow>
					</mx:Grid>
					</s:NavigatorContent>
				</mx:TabNavigator>
				
				<mx:TabNavigator chromeColor="#ffffff" creationPolicy="all" width="1250">
					<s:NavigatorContent  label="登记信息">
						<s:VGroup paddingBottom="10" paddingLeft="10" paddingRight="10">
							<mx:Grid>
								
								<mx:GridRow>
									
									<mx:GridItem>
										<s:Label styleName="myLabel" text="登记人员"/>
										<component:FindSelectedItemComboBox id="E705_12" width="130" height="22"
																			editable="true" restrict="^0-9"/>
										<s:Label text="*" styleName="must myLabel"/>
										
									</mx:GridItem>
									
									<mx:GridItem>
										<s:Label styleName="pf15 myLabel" text="录入单位"/>
										<s:DropDownList id="E705_11" enabled="false"  width="130"/>
										<s:Label text="*" styleName="must myLabel"/>
										
									</mx:GridItem>
									
									<mx:GridItem>
										<s:Label styleName="pf15 myLabel" text="录入时间"/>
										<component:CustomRangeDateField id="E705_13" enabled="false"
																		isSelectNow="true"/>
										<s:Label  styleName="must myLabel" text="*"/>
										
									</mx:GridItem>
									
									
								</mx:GridRow>
							</mx:Grid>
						</s:VGroup>
					</s:NavigatorContent>
				</mx:TabNavigator>
				</s:VGroup>
				
				<s:HGroup width="1250"  horizontalAlign="center">
					<s:Button label="保存" click="save_clickHandler(event)" id="save"/>
				</s:HGroup>  
				
			</s:VGroup>  
			
		</s:Scroller>
</s:TitleWindow>
