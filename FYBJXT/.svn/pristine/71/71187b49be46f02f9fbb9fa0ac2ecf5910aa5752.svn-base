<?xml version="1.0" encoding="utf-8"?>
<s:VGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx" 
		  xmlns:gja="com.xyw.module.msss.la.fngjadacx.*"
		  creationComplete="init()"
		  width="100%" height="100%">
	<fx:Declarations>
		
		<s:RemoteObject id="l302Service" destination="l302Service"
						endpoint="{this.parentApplication.contextRoot}/messagebroker/amf"
						showBusyCursor="true">
			<s:method name="saveL302" result="saveOrRenewL302Handler(event)"/>
			<s:method name="renewL302" result="saveOrRenewL302Handler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Metadata>
		[Event(name="saveSuccess", type="flash.events.Event")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import com.xyw.module.msss.la.model.L302;
			import com.xyw.module.msss.la.model.L302Request;
			import com.xyw.module.msss.la.model.VL302;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.model.ComboBoxDataRequest;
			import com.xyw.sys.model.SystemUser;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.events.CloseEvent;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			private var comboBoxDataRequest:ComboBoxDataRequest;
			private var systemUser:SystemUser;
			private var l302:L302;
			public  var l30202:String;
			public var l30204:String;
			public var state:String;
			public var vl302:VL302;
			private var i:int=0;
			private var tabHeight:Number;
			private function init():void
			{
				tabHeight=tab.height;
				if("0"==state)
					callLater(updatezzbl);
				systemUser=this.parentApplication.systemUser;
			}
			
			private function jcdjCreationComplete():void
			{
				check.institution.text="诊断机构";
				check.Checkname.text="报告人员";
				check.time.text="诊断日期";
				if('1'==state)
			    	check._initializeComboBox('5');
			}
			private function updatezzbl():void
			{
				L302_97.text=vl302.l30297;
				CompMethod.setRadioButtonSelect([L302_95],vl302.l30295);
				CompMethod.setRadioButtonSelect([Item96_1,Item96_2,Item96_3,
												 Item96_4,Item96_5,Item96_6,
												 Item96_7,Item96_8,Item96_9],vl302.l30296);
				callLater(institutionCodeDataProvider);
			}
			
			private function institutionCodeDataProvider():void
			{
				if(!(check.institutionCode.dataProvider))
				{
					callLater(institutionCodeDataProvider);
					return ;				
				}
				addText();
				check.checker.text=vl302.l30299;
				check.nowDate.text=vl302.l302100str;
				check.institutionCode.selectedIndex=CompMethod.getDropDownListSelectedIndex(ArrayCollection(check.institutionCode.dataProvider),vl302.l30298);
			}
			
			private function verificationZZBL():Boolean
			{
				if(!vl302.l30292)
				{
					Alert.show("请先登记阴道镜检查","系统提示");
					return false;
				}
				
				if(!check.checker.text)
				{
					Alert.show("请输入报告人员信息","系统提示");
					return false;
				}
				
				if(l302.l30295=='2')
				{
					if(!l302.l30296)
					{
						Alert.show("请选择异常原因！","系统提示");
						return false;
					}else if(l302.l30296=='9'&&!L302_97.text)
					{
						Alert.show("请输入其他原因！","系统提示");
						return false;
					}
						
				}
				return true;
			}
		
			private function savezzbl():void
			{
				l302=new L302();
				var l302Request:L302Request=new L302Request();
				l302.l30295=CompMethod.getRadioButtonValue([L302_95]);
				l302.l30296=CompMethod.getRadioButtonValue([Item96_1,Item96_2,Item96_3,
												Item96_4,Item96_5,Item96_6,
												Item96_7,Item96_8,Item96_9]);
				if(!verificationZZBL())
					return ;
				l302.l30297=StringUtil.trim(L302_97.text);
				l302.l30298=check.institutionCode.selectedItem.data;
				l302.l30299=StringUtil.trim(check.checker.text);
				l302.l302100=DateField.stringToDate(check.nowDate.text,"YYYY-MM-DD");
				l302Request.flag="6";
				if("0"==state)
				{
					l302.l30201=vl302.l30201;
					l302Request.l302=l302;
					l302Service.renewL302(l302Request);
				}else
				{		
					save.enabled=false;
					l302.l30202=l30202;
					l302Request.l302=l302;
					l302Service.saveL302(l302Request);
				}
			}
			
			private function saveOrRenewL302Handler(event:ResultEvent):void
			{
				var l302Response:Object=event.result;
				save.enabled=true;
				if(l302Response.state)
				{
					this.dispatchEvent(new Event("saveSuccess"));
					Alert.show(l302Response.promptMessage,"系统提示");
					return ;
				}
				Alert.show(l302Response.errorMessage,"系统提示");
			}
			
			private function addText():void
			{
				if(lastGridRow.visible&&tab.height==tabHeight)
					tab.height+=30; 
				
			}
			
			private function removeText():void
			{
				
				L302_97.text='';
				if(!lastGridRow.visible&&tab.height!=tabHeight)
					tab.height-=30; 
				
			}
			
		]]>
	</fx:Script>
	<s:Scroller x="-6" y="1" width="100%" height="100%" horizontalScrollPolicy="auto"
				verticalScrollPolicy="auto">
		<s:VGroup paddingBottom="20" paddingLeft="10" paddingRight="10" paddingTop="10">
			<s:HGroup width="100%" horizontalAlign="center">
				<s:Label color="#F11616" fontSize="20" text="登记此项必须先登记阴道镜检查!"/>
			</s:HGroup>
			<mx:TabNavigator width="800" id="tab" chromeColor="#ffffff" creationPolicy="all">
				<s:NavigatorContent width="100%" label="组织病理学检查">
					<s:VGroup width="100%" height="100%" >
					
					<s:HGroup paddingBottom="5" paddingLeft="10" paddingRight="10" verticalAlign="middle">	
							<s:Label width="119" text="组织病理学检查结果"/>
							<s:HGroup width="100%" height="100%" paddingBottom="3" verticalAlign="middle" id="L302_95">
								<s:RadioButton width="99" label="1.未见异常" groupName="L302_95" selected="true"  value="1"
											   buttonMode="true" id="L302_95_01" click="CompMethod._walk(grid96);callLater(removeText,[null])"/>
								<s:RadioButton width="81" label="2.异常" groupName="L302_95" buttonMode="true" value="2" id="L302_95_02"/>
						</s:HGroup>
					
					</s:HGroup>
					
					<s:VGroup width="100%" height="100%" paddingLeft="150" enabled="{L302_95_02.selected}">
						<mx:Grid id="grid96">
							<mx:GridRow>
								<mx:GridItem verticalAlign="middle">
									<s:Label text="异常原因"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_1">
									<s:RadioButton label="炎症" buttonMode="true" value="1" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_2">
									<s:RadioButton label="低级别鳞状上皮内病变" buttonMode="true" value="2" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_3">
									<s:RadioButton label="高级别鳞状上皮内病变" buttonMode="true" value="3" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_4">
									<s:RadioButton label="宫颈原位腺癌" buttonMode="true" value="4" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
							</mx:GridRow>
							
							<mx:GridRow>
								<mx:GridItem  height="12"/>
								
								<mx:GridItem id="Item96_5">
									<s:RadioButton label="宫颈微小浸润鳞癌" buttonMode="true" value="7" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_6">
									<s:RadioButton label="宫颈微小浸润腺癌" buttonMode="true" value="8" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_7" colSpan="2">
									<s:RadioButton label="宫颈浸润鳞癌" buttonMode="true" value="10" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
							</mx:GridRow>
							
							
							
							<mx:GridRow>
								<mx:GridItem  height="12"/>
								
								<mx:GridItem id="Item96_8">
									<s:RadioButton label="宫颈浸润腺癌" buttonMode="true" value="11" groupName="L302_96" change="callLater(removeText)"/>
								</mx:GridItem>
								
								<mx:GridItem id="Item96_9">
									<s:RadioButton id="L302_96_9" label="其他恶性肿瘤" buttonMode="true" value="9" groupName="L302_96" change="callLater(addText)"/>
								</mx:GridItem>
								
							</mx:GridRow>
							
							<mx:GridRow id="lastGridRow" includeInLayout="{L302_96_9.selected}" visible="{L302_96_9.selected}">
								<mx:GridItem verticalAlign="middle" colSpan="5" >
									<s:Label text="其他说明"/>
									<s:TextInput id="L302_97" width="100%"/>
								</mx:GridItem>
								
							</mx:GridRow>
						</mx:Grid>
						</s:VGroup>
					</s:VGroup>  
				</s:NavigatorContent>
				
			</mx:TabNavigator>
			<gja:gjajcdj width="800" chromeColor="#ffffff" creationPolicy="all" creationComplete="jcdjCreationComplete()" id="check" />
			<s:HGroup width="800" height="30" contentBackgroundColor="#FF0000" horizontalAlign="center"
					  paddingBottom="20" paddingLeft="10" paddingTop="10" verticalAlign="middle">
				<s:Button label="保存" buttonMode="true" id="save" click="savezzbl()"/>
			</s:HGroup>
		</s:VGroup>
	</s:Scroller>
</s:VGroup>
