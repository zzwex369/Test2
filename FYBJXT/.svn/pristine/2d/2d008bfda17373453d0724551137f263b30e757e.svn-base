<%@ page contentType="text/html; charset=utf-8"%>
<%@ include file = "../../GenXmlData.jsp" %>
<%
 //  System.out.println(">>>>>>>>>>");
String timeStr=request.getParameter("timeStr");
String timeEnd=request.getParameter("timeEnd");
String institution=request.getParameter("institution");

 /*
   System.out.println(timeStr);
   System.out.println(timeEnd);
   System.out.println(institution);
   System.out.println(e70208);*/
StringBuffer sql = new StringBuffer("select d201_04, sum(YCRS) e,");
sql.append("sum(JCRS) c from(");
sql.append("select d201_04,0 as YCRS, count(*) as JCRS");
sql.append(" from d201_ms,e702 ");
//sql.append(" where d201_01 = substr("+institution+",0,6)");
if(institution.length() > 4){
	sql.append(" where d201_01 = substr("+institution+",0,6)");
}else{
	sql.append(" where d201_01 like '"+institution+"__'");
}
sql.append(" and e702_09 = 1 ");
sql.append(" and e702_73 >= to_date('"+timeStr+"','yyyy-mm-dd') ");
sql.append(" and e702_73 <= to_date('"+timeEnd+"','yyyy-mm-dd') ");
sql.append("  group by d201_04 ");
sql.append(" union all ");
sql.append(" select d201_04,count(*) as YCRS,0 as JCRS  ");
sql.append(" from d201_ms,e702 ");
//sql.append(" where d201_01 = substr("+institution+",0,6) ");
if(institution.length() > 4){
	sql.append(" where d201_01 = substr("+institution+",0,6)");
}else{
	sql.append(" where d201_01 like '"+institution+"__'");
}
sql.append("  and e702_09 = 1 ");
sql.append("  and e702_60 = 2 ");
sql.append(" and e702_73 >= to_date('"+timeStr+"','yyyy-mm-dd') ");
sql.append(" and e702_73 <= to_date('"+timeEnd+"','yyyy-mm-dd') ");
sql.append(" group by d201_04) ");
sql.append(" group by d201_04 ");



//	 System.out.println(sql);
 /*  System.out.println(timeStr);
   System.out.println(timeEnd);
   System.out.println(institution);
   System.out.println(e70208);*/

%>
<%
XML_GenOneRecordset(response,sql.toString());
%>