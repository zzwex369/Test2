<?xml version="1.0" encoding="utf-8"?>
<s:Module xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark"
		  xmlns:component = "com.xyw.sys.custom.component.*"
		  creationComplete="moduleCreationCompleteHandler(event)"
		  xmlns:mx="library://ns.adobe.com/flex/mx" 
		  width="100%" height="100%">
	<fx:Declarations>
		<s:RemoteObject id="systemService" destination="systemService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="getComboBoxData" result="getComboBoxDataHandler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		mx|GridItem
		{
			verticalAlign:middle;
		}
		s|Button
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomButtonSkin");
		}
		s|DropDownList
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomDropDownListSkin");
			selectionColor:#DDDDDD;
			rollOverColor:#EEEEEE;	
		}
		
	</fx:Style>
	
	<fx:Script>
		<![CDATA[
			import com.as3xls.xls.Obj;
			import com.xyw.sys.constant.SystemConstant;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.model.ComboBoxData;
			import com.xyw.sys.model.ComboBoxDataRequest;
			import com.xyw.sys.model.ComboBoxDataResponse;
			import com.xyw.sys.model.SessionException;
			import com.xyw.sys.model.SystemUser;
			import mx.controls.Alert;
			import flash.net.navigateToURL;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.CalendarLayoutChangeEvent;
			import mx.events.FlexEvent;
			import mx.formatters.DateFormatter;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			private var comboBoxDataRequest:ComboBoxDataRequest;
			public var systemUser:SystemUser = null;
			public var alert:Alert = null;
			
			protected function moduleCreationCompleteHandler(event:FlexEvent):void
			{
				this.systemUser = this.parentApplication.systemUser;
				this.timeStart.text=DateField.dateToString(new Date(),"YYYY-MM-01");
				this.timeEnd.text=DateField.dateToString(new Date(),"YYYY-MM-DD");
				/* institutionId.town.enabled = false; */
				this.initializeComboBox();
				this.initializeComboBox1();
			}
			private function initializeComboBox():void{
				//风险结论  Z602_01
				comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.sql = "select * from Z602_01";
				comboBoxDataRequest.flag = "Z602_01";
				this.systemService.getComboBoxData(this.comboBoxDataRequest); 
			}
			private function getComboBoxDataHandler(event:ResultEvent):void
			{
				var comboBoxDataResponse:Object =event.result;
				var flag:String =comboBoxDataResponse.flag;
				var comboBoxDataList:ArrayCollection =comboBoxDataResponse.comboBoxDataList;
				if(flag=="Z602_01"){
					this.trisomy_21.dataProvider = comboBoxDataList;
					this.trisomy_21.selectedIndex=0;
					this.NTD.dataProvider = comboBoxDataList;
					this.NTD.selectedIndex=0;
					this.Age_risk.dataProvider = comboBoxDataList;
					this.Age_risk.selectedIndex=0;
				}
				if(flag == "D101")
				{
					this.unit.dataProvider = comboBoxDataList;
					this.unit.selectedIndex = CompMethod.getDropDownListSelectedIndex(ArrayCollection(comboBoxDataList),this.systemUser.institutionCode);
				}
			}
			private function initializeComboBox1():void{
				var showPrompt:Boolean=true;
				var sql:String="select t.d101_01, t.d101_02 from D101 t where t.D101_19 ";
				if(this.systemUser.institutionCode=="41130300000002" || this.systemUser.institutionCode=="41130200000006")
				{
					sql+="="+this.systemUser.institutionCode;
					showPrompt=false;
					unit.mouseChildren=true;
				}else{
					sql+="is not null";
				}
				comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.sql =sql;
				//comboBoxDataRequest.sql ="select t.d101_01, t.d101_02 from D101 t where t.d101_01 = '" + this.systemUser.institutionCode + "' or t.d101_11 ='" + this.systemUser.institutionCode +"'";
				comboBoxDataRequest.flag = "D101";
				this.systemService.getComboBoxData(this.comboBoxDataRequest); 
			}
			private function query():void
			{ 
					var param:String="";
					var address_status:String=null;
					var unit:String = this.unit.selectedItem.data;
					var trisomy_21:String = this.trisomy_21.selectedItem.data;
					var NTD:String = this.NTD.selectedItem.data;
					var Age_risk:String = this.Age_risk.selectedItem.data;
					var hospital:String=this.systemUser.institutionCode;
					if(this.f60129.selected){
						address_status="0";//产妇户口地址
					}else if(this.f60163.selected)
					{
						address_status="1";//产妇现在住址
					}
					param=getRadioButtonValue(this.address)+"="+F601addr.getAreaCode()+
						"&f60141="+getRadioButtonValue(F601_41)+"&timeStr="+timeStart.text+
						"&"+"timeEnd="+timeEnd.text+"&timeTag="+getRadioButtonValue(time)+"&status=1"+"&trisomy_21="+trisomy_21+"&NTD="+NTD+"&Age_risk="+Age_risk+"&unit="+unit+"&hospital="+hospital+"&address_status="+address_status;
				
				
				var url:String = this.parentApplication.contextRoot + "/report_new/jsp/fnbj/cqsc.jsp?"+param;
				navigateToURL(new URLRequest(url), null); 
			}
			
			private function getRadioButtonValue(id:Object):String
			{
				var radioButton:RadioButton;
				var value:String;
				for(var i:int =0;i<id.numElements;i++)
				{
					radioButton=id.getElementAt(i) as RadioButton;
					if(radioButton.selected)
					{
						value=radioButton.value.toString();
						break;
					}
				}
				return value;
			}
			
			private function getDroupDownListSelectedIndex(arrayCollection:ArrayCollection,defaultValue:String):int{
				var len:int =arrayCollection.length;
				var i:uint =0;
				var index:int =0;
				while(i<len){
					var comboBoxDataP:Object =arrayCollection.getItemAt(i);
					if(comboBoxDataP.data ==defaultValue){
						index =arrayCollection.getItemIndex(comboBoxDataP);
						break;
					}
					i++;
				}
				return index;
			}
			private function radiobutton_clickHandler(label:Object,event:MouseEvent):void
			{
				label.text=event.target.label;
				
			}
			
			
		]]>
	</fx:Script>
	
	<s:VGroup>
		<mx:TabNavigator  width="1200" chromeColor="#ffffff" creationPolicy="all">
			<s:NavigatorContent  label="综合查询" width="100%">
				<s:VGroup paddingBottom="10" paddingLeft="10" paddingRight="10">
					<mx:Grid width="100%">
						<mx:GridRow>
							<mx:GridItem>
								<s:Label  text="单位查询"/>
								<s:HGroup width="151" height="100%" gap="5" paddingLeft="10" id="code">
									<s:RadioButton id="f60129" buttonMode="true" label="采血单位" value="f60129" groupName="code" click="radiobutton_clickHandler(institutionLabel,event)" selected="true"/>
									<s:RadioButton id="f60163" buttonMode="true" label="审核单位"  value="f60163" groupName="code" click="radiobutton_clickHandler(institutionLabel,event)"/>
								</s:HGroup>
								<s:HGroup width="100%" height="100%" gap="5" paddingLeft="10">
									<s:Label width="74" text="采血单位" paddingTop="5" id="institutionLabel"/>
									<s:DropDownList width="263" id="unit" mouseChildren="false"/>
								</s:HGroup>	
							</mx:GridItem>
						</mx:GridRow>
						
						<mx:GridRow>
							<mx:GridItem>
								<s:Label  text="地址查询"/>
								<s:HGroup width="100%" height="100%" gap="5" paddingLeft="10" id="address">
									<s:RadioButton buttonMode="true" label="未选择" value="" groupName="address" click="radiobutton_clickHandler(addr,event)" selected="true"/>
									<s:RadioButton buttonMode="true" label="现在住址" value="f60144" groupName="address" click="radiobutton_clickHandler(addr,event)"/>
									<s:RadioButton buttonMode="true" label="户口地址"  value="f60156" groupName="address" click="radiobutton_clickHandler(addr,event)"/>
								</s:HGroup>  
								<s:HGroup width="100%" height="100%" paddingLeft="10">
									<s:Label width="57" text="现在住址" id="addr" paddingTop="5"/>
									<component:AreaComboBoxVillageAuto id="F601addr" width="844" buttonMode="true" table="D201_MS" 
																	   areaCode="4113"/>
								</s:HGroup>
							</mx:GridItem>
						</mx:GridRow>		
						
						<mx:GridRow>
							<mx:GridItem>
								<s:Label  text="收费方式"/>
								<s:HGroup width="100%" height="100%" gap="40" paddingLeft="10" id="F601_41">
									<s:RadioButton buttonMode="true" label="全部" value="0" groupName="F601_41" selected="true"/>
									<s:RadioButton buttonMode="true" label="免费" value="1" groupName="F601_41"/>
									<s:RadioButton buttonMode="true" label="自费"  value="2" groupName="F601_41"/>
								</s:HGroup>  
								
							</mx:GridItem>
						</mx:GridRow>
						
						
						<mx:GridRow>
							<mx:GridItem>
								<s:Label  text="日期查询"/>
								<s:HGroup width="100%" height="100%" gap="40" paddingLeft="10" id="time">
									<s:RadioButton buttonMode="true" label="录入时间" value="f601_26" groupName="time" selected="true" click="radiobutton_clickHandler(label,event)"/>
									<s:RadioButton buttonMode="true" label="采血日期" value="f601_34" groupName="time" click="radiobutton_clickHandler(label,event)"/>
									<s:RadioButton buttonMode="true" label="邮寄日期"  value="f601_57" groupName="time" click="radiobutton_clickHandler(label,event)"/>
									<s:RadioButton buttonMode="true" label="审核日期" value="f601_60" groupName="time" click="radiobutton_clickHandler(label,event)"/>
									<s:RadioButton buttonMode="true" label="报告日期"  value="f601_71" groupName="time" click="radiobutton_clickHandler(label,event)"/>
								</s:HGroup>  
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label  text="风险级别"/>
								<s:HGroup paddingLeft="10" width="100%" verticalAlign="middle" >
									<s:Label text="21三体-风险"/><s:DropDownList width="90" id="trisomy_21"/>
									<s:Label text="神经管缺陷"/><s:DropDownList width="90" id="NTD"/>
									<s:Label text="预产期年龄风险"/><s:DropDownList width="90" id="Age_risk"/>
								</s:HGroup >
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label text="录入日期" id="label"/>
								<mx:DateField yearNavigationEnabled="true" id="timeStart" width="120" dayNames='["周日","周一","周二","周三","周四","周五","周六"]'
											  monthNames='["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]'
											  formatString="YYYY-MM-DD" text="{DateField.dateToString(new Date(),'YYYY-MM-01')}"/>
								<s:Label text="至"/>
								<mx:DateField yearNavigationEnabled="true" id="timeEnd" width="120" dayNames='["周日","周一","周二","周三","周四","周五","周六"]'
											  monthNames='["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]'
											  formatString="YYYY-MM-DD" text="{DateField.dateToString(new Date(),'YYYY-MM-DD')}"/>
								<s:Button label="查询" click="query()"/>
							</mx:GridItem>
						</mx:GridRow>
						
						
					</mx:Grid>
				</s:VGroup>
			</s:NavigatorContent>
		</mx:TabNavigator>
	</s:VGroup>
</s:Module>