<?xml version="1.0" encoding="utf-8"?>
<s:HGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx"
		  verticalAlign="middle" horizontalAlign="center"
		  creationComplete="hgroupCreationCompleteHandler(event)">
	<fx:Declarations>
		<s:RemoteObject id="systemService" destination="systemService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="getCustomAreaComboBoxDataJS" result="getCustomAreaComboBoxDataJSHandler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.xyw.module.csyxzm.cszsl.index;
			import com.xyw.sys.event.CustomAreaCityEvent;
			import com.xyw.sys.event.CustomAreaCountyEvent;
			import com.xyw.sys.event.CustomAreaTownEvent;
			import com.xyw.sys.model.AreaRequest;
			import com.xyw.sys.model.AreaResponse;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			import spark.events.IndexChangeEvent;
			
			private var areaRequest:AreaRequest = null;
			public var areaCode:String = "";
			
			[Bindable]
			private var idx:index = null;
			
			private function hgroupCreationCompleteHandler(event:FlexEvent):void
			{
				if(areaCode == "")
				{
					areaCode = this.parentApplication.systemUser.areaCode;
				}
				this.setAreaCode(areaCode);
			}
			
			public function setAreaCode(areaCode:String):void
			{
				//省级
				if(areaCode.length == 2) {
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "province";
					this.systemService.getCustomAreaComboBoxDataJS(areaRequest);//省
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = true;
					this.areaRequest.areaFlag = "province";
					this.systemService.getCustomAreaComboBoxDataJS(areaRequest);//省
				}
				//市级
				if(areaCode.length == 4) {
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 2);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "province";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//省
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "city";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//市
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = true;
					this.areaRequest.areaFlag = "city";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//县
				}
				//县级
				if(areaCode.length == 6) {
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 2);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "province";
					
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//省
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 4);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "city";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//市
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "county";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//县
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = true;
					this.areaRequest.areaFlag = "county";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//县
				}
				//乡镇级
				if(areaCode.length == 9){
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 2);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "province";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//省
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 4);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "city";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//市
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode.substr(0, 6);
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "county";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//县
					
					this.areaRequest = new AreaRequest();
					this.areaRequest.areaCode = areaCode;
					this.areaRequest.showPrompt = false;
					this.areaRequest.areaFlag = "town";
					this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);//乡镇
				}
				this.city.addEventListener(IndexChangeEvent.CHANGE, cityDropDownListIndexChangeHandler);
				this.county.addEventListener(IndexChangeEvent.CHANGE, countyDropDownListIndexChangeHandler);
				this.town.addEventListener(IndexChangeEvent.CHANGE, townDropDownListIndexChangeHandler);
				//this.country.addEventListener(IndexChangeEvent.CHANGE, countryDropDownListIndexChangeHandler);
				this.province.selectedIndex = 0;
				this.city.selectedIndex = 0;
				this.county.selectedIndex = 0;
				this.town.selectedIndex = 0;
				this.country.selectedIndex = 0;
				//this.group.selectedIndex = 0;
			}
			
			
			public function getAreaName():String{
				var areaName:String = null;
				try{
					if(province.selectedItem.data!=""){
						areaName=province.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(city.selectedItem.data!=""){
						areaName+=city.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(county.selectedItem.data!=""){
						areaName+=county.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(town.selectedItem.data!=""){
						areaName+=town.selectedItem.label;
					}
				}catch(e:Error){}
				/*
				try{
				if(country.selectedItem.data!=""){
				areaName+=country.selectedItem.label;
				}
				}catch(e:Error){}
				try {
				if(this.group.selectedItem.data != "") {
				areaName+=group.selectedItem.label;
				}
				}catch(e:Error){}
				*/
				return areaName;
			}
			
			
			private function cityDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var cityData:String = DropDownList(event.target).selectedItem.data;
				this.areaRequest = new AreaRequest();
				this.areaRequest.areaCode = cityData;
				this.areaRequest.showPrompt = true;
				this.areaRequest.areaFlag = "city";
				this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);
				if(this.areaCode.length == 2) {
					this.dispatchEvent(new CustomAreaCityEvent(this.getAreaCode(), CustomAreaCityEvent.CUSTOMAREACITYEVENT, true));
				}
			}
			
			private function countyDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var countyData:String = DropDownList(event.target).selectedItem.data;
				this.areaRequest = new AreaRequest();
				this.areaRequest.areaCode = countyData;
				this.areaRequest.showPrompt = true;
				this.areaRequest.areaFlag = "county";
				this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);
				
				if(this.areaCode.length == 4) {
					this.dispatchEvent(new CustomAreaCountyEvent(this.getAreaCode(), CustomAreaCountyEvent.CUSTOMAREACOUNTYEVENT, true));
				}
			}
			
			private function townDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var townData:String = DropDownList(event.target).selectedItem.data;
				this.areaRequest = new AreaRequest();
				this.areaRequest.areaCode = townData;
				this.areaRequest.showPrompt = true;
				this.areaRequest.areaFlag = "town";
				this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);
				if(this.areaCode.length == 6) {
					this.dispatchEvent(new CustomAreaTownEvent(this.getAreaCode(), CustomAreaTownEvent.CUSTOMAREATOWNEVENT, true));
				}
			}
			
			private function countryDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var groupData:String = DropDownList(event.target).selectedItem.data;
				this.areaRequest = new AreaRequest();
				this.areaRequest.areaCode = groupData;
				this.areaRequest.showPrompt = true;
				this.areaRequest.areaFlag = "country";
				this.systemService.getCustomAreaComboBoxDataJS(this.areaRequest);
				
			}
			
			private function commityDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				
			}
			
			private function getCustomAreaComboBoxDataJSHandler(event:ResultEvent):void
			{
				var areaResponse:Object = event.result;
				var areaFlag:String = areaResponse.areaFlag;
				var showPrompt:Boolean = areaResponse.showPrompt;
				var comboBoxDataList:ArrayCollection = areaResponse.comboBoxDataList;
				if(areaFlag == "province") {
					if(showPrompt) {
						this.city.dataProvider = comboBoxDataList;
						this.city.selectedIndex = 0;
						this.county.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.county.selectedIndex = 0;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
					} else {
						this.province.dataProvider = comboBoxDataList;
						this.province.selectedIndex = 0;
						this.city.selectedIndex = 0;
						this.county.selectedIndex = 0;
						this.town.selectedIndex = 0;
						this.country.selectedIndex = 0;
						//this.group.selectedIndex = 0;
					}
				} else if(areaFlag == "city") {
					if(showPrompt) {
						this.county.dataProvider = comboBoxDataList;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.county.selectedIndex = 0;
					} else {
						this.city.dataProvider = comboBoxDataList;
						this.county.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.city.selectedIndex = 0;
					}
					this.town.selectedIndex = 0;
					this.country.selectedIndex = 0;
				} else if(areaFlag == "county") {
					if(showPrompt) {
						this.town.dataProvider = comboBoxDataList;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
						this.country.selectedIndex = 0;
						//this.group.selectedIndex = 0;
					} else {
						this.county.dataProvider = comboBoxDataList;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.county.selectedIndex = 0;
						this.country.selectedIndex = 0;
						//this.group.selectedIndex = 0;
					}
				}
					
				else if(areaFlag == "town") {
					if(showPrompt) {
						this.country.dataProvider = comboBoxDataList;
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.selectedIndex = 0;
						//this.group.selectedIndex = 0;
					} else {
						this.town.dataProvider = comboBoxDataList;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
						//this.group.selectedIndex = 0;
					}
				} else if(areaFlag == "country") {
					if(showPrompt) {
						//this.group.dataProvider = comboBoxDataList;
						//this.group.selectedIndex = 0;
					} else {
						this.country.dataProvider = comboBoxDataList;
						//this.group.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						//this.group.selectedIndex = 0;
					}
				}
				
			}
			
			public function getAreaCode():String
			{
				var areaCode:String = null;
				if(this.city.selectedItem.data == "") {
					areaCode = 	this.province.selectedItem.data;
					return areaCode;
				} else if(this.county.selectedItem.data == "") {
					areaCode = 	this.city.selectedItem.data;
					return areaCode;
				} else if(this.town.selectedItem.data == "") {
					areaCode = 	this.county.selectedItem.data;
					return areaCode;
				} else if(this.country.selectedItem.data == ""){
					areaCode = 	this.town.selectedItem.data;
					return areaCode;
				} else {
					areaCode = this.country.selectedItem.data;
					return areaCode;
				}
				
				return null;
				
				/*
				 else if(this.group.selectedItem.data == ""){
				areaCode = this.country.selectedItem.data;
				return areaCode;
				} else {
				areaCode = this.group.selectedItem.data;
				return areaCode;
				}
				*/
			}
			
			public function getAreaType():String
			{
				var areaType:String = "";
				if(this.town.selectedItem.data != "")
				{
					areaType = "8";
				}else if(this.county.selectedItem.data != "")
				{
					areaType = "6";
				}else if(this.city.selectedItem.data != "")
				{
					areaType = "4";
				}else if(this.province.selectedItem.data != "")
				{
					areaType = "2";
				}
				return areaType;
			}
			
		]]>
	</fx:Script>
	<s:Label text="省" width="15"/><s:DropDownList id="province" width="100%"/><s:Label text="市" width="15"/><s:DropDownList id="city" width="100%"/>
	<s:Label text="县区" width="30"/><s:DropDownList id="county" width="100%"/><s:Label text="乡镇" width="30"/><s:DropDownList id="town" width="100%"/>
	<s:Label text="村" width="15"/><s:DropDownList id="country" width="100%"/>
	<!--<s:Label text="组"/><s:DropDownList id="group" width="150"/>-->
	
</s:HGroup>