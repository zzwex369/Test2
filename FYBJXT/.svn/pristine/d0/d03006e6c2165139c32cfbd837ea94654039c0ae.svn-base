<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   width="800" height="125" chromeColor="#429edd"
			   creationComplete="titlewindowCreationCompleteHandler(event)"
			   close="closeTitleWindow()" title="出生证调剂登记"
			   skinClass="com.xyw.sys.custom.skin.CustomTitleWindow" xmlns:component="com.xyw.sys.custom.component.*">
	<fx:Declarations>
		<s:RemoteObject id="certificateRegistService" destination="certificateRegistService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="save" result="saveHandler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.xyw.module.csyxzm.model.D506;
			import com.xyw.module.csyxzm.model.D506Request;
			import com.xyw.module.csyxzm.model.D506Response;
			import com.xyw.module.csyxzm.model.VD502;
			import com.xyw.sys.model.SystemUser;
			
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			
			private var systemUser:SystemUser;
			public var vd502:VD502;
			
			private function titlewindowCreationCompleteHandler(event:FlexEvent):void
			{
				this.systemUser = this.parentApplication.systemUser;
				this.d506_03.text = this.systemUser.institution;
				this.d506_03.enabled = false;
				this.d506_08.text = this.vd502.d50202Zh;
				this.d506_08.enabled = false;
				this.d506_05.text = this.vd502.d50211;
				this.d506_05.enabled = false;
				
				this.d506_06.addEventListener(FocusEvent.FOCUS_OUT, onD50206FocusOut);
				this.d506_07.addEventListener(FocusEvent.FOCUS_OUT, onD50207FocusOut);
				
				this.d506_10.enabled = false;
			}
			
			private function onD50206FocusOut(event:FocusEvent):void
			{
				var d506_06_text_num:Number = Number(this.d506_06.text);
				var d506_07_text_num:Number = Number(this.d506_07.text);
				this.d506_10.text = (d506_07_text_num - d506_06_text_num + 1) + "";
			}
			
			private function onD50207FocusOut(event:FocusEvent):void
			{
				var d506_06_text_num:Number = Number(this.d506_06.text);
				var d506_07_text_num:Number = Number(this.d506_07.text);
				this.d506_10.text = (d506_07_text_num - d506_06_text_num + 1) + "";
			}
			
			private function closeTitleWindow():void
			{
				PopUpManager.removePopUp(this);
			}
			
			private function saveHandler(event:ResultEvent):void
			{
				PopUpManager.removePopUp(this);
				var d506Response:D506Response = event.result as D506Response;
				if(d506Response.errorMessage == null) {
					Alert.show(d506Response.promptMessage, "系统提示");
				} else {
					Alert.show(d506Response.errorMessage, "系统提示");
				}
			}
			
			private function validateData():void
			{
				
				if(this.d506_03.text == null || StringUtil.trim(this.d506_03.text).length == 0) {
					Alert.show("调剂单位不能为空!", "系统提示");
					this.d506_03.setFocus();
					return;
				}
				
				if(this.d506_04.text == null || StringUtil.trim(this.d506_04.text).length == 0) {
					Alert.show("调剂人不能为空!", "系统提示");
					this.d506_04.setFocus();
					return;
				}
				
				if(this.d506_08.text == null || StringUtil.trim(this.d506_08.text).length == 0) {
					Alert.show("原单位不能为空!", "系统提示");
					this.d506_08.setFocus();
					return;
				}
				
				if(this.d506_10.text == null || StringUtil.trim(this.d506_10.text).length == 0) {
					Alert.show("调剂数量不能为空!", "系统提示");
					this.d506_10.setFocus();
					return;
				}
				if(this.d506_05.text == null || StringUtil.trim(this.d506_05.text).length == 0) {
					Alert.show("首字母不能为空!", "系统提示");
					this.d506_05.setFocus();
					return;
				}
				
				if(this.d506_06.text == null || StringUtil.trim(this.d506_06.text).length == 0) {
					Alert.show("起始编号不能为空!", "系统提示");
					this.d506_06.setFocus();
					return;
				}else {
					var d506_06_num:Number = Number(this.d506_06.text);
					var d506_09_num:Number = Number(this.vd502.d50209);
					
					if(d506_06_num < d506_09_num) {
						Alert.show("调剂起始编号超出范围!", "系统提示");
						this.d506_06.setFocus();
						return;
					}
				}
				
				if(this.d506_07.text == null || StringUtil.trim(this.d506_07.text).length == 0) {
					Alert.show("终止编号不能为空!", "系统提示");
					this.d506_07.setFocus();
					return;
				} else {
					var d506_07_num:Number = Number(this.d506_07.text);
					var d506_10_num:Number = Number(this.vd502.d50210);
					
					if(d506_07_num > d506_10_num) {
						Alert.show("调剂终止编号超出范围!", "系统提示");
						this.d506_07.setFocus();
						return;
					}
				}
				
				var d506_06_text_num:Number = Number(this.d506_06.text);
				var d506_07_text_num:Number = Number(this.d506_07.text);
				if(d506_06_text_num > d506_07_text_num) {
					Alert.show("起始编号不能大于终止编号!", "系统提示");
					this.d506_06.setFocus();
					return;
				}
				
				if(this.d506_09.selectedDate == null) {
					Alert.show("调剂日期不能为空!", "系统提示");
					this.d506_09.setFocus();
					return;
				}
			}
			
			private function moveConfirm(event:MouseEvent):void
			{
				this.validateData();
				var d506Request:D506Request = new D506Request();
				var d506:D506 = new D506();
				d506.d506_02 = this.vd502.d50201;
				d506.d506_03 = this.systemUser.institutionCode;
				d506.d506_04 = this.d506_04.text;
				d506.d506_05 = this.vd502.d50211;
				d506.d506_06 = this.d506_06.text;
				d506.d506_07 = this.d506_07.text;
				d506.d506_08 = this.vd502.d50202;
				d506.d506_09 = this.d506_09.selectedDate;
				d506Request.d506 = d506;				
				this.certificateRegistService.save(d506Request);
			}
		]]>
	</fx:Script>
	<s:VGroup chromeColor="#ffffff" width="100%" height="100%" paddingBottom="10" paddingLeft="10" paddingRight="10" paddingTop="10">
		<mx:Grid width="100%" height="100%">
			<mx:GridRow>
				<mx:GridItem>
					<s:Label text="调剂单位"/><s:TextInput id="d506_03"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="调剂人"/><s:TextInput id="d506_04"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="原单位"/><s:TextInput id="d506_08"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="调剂数量"/><s:TextInput id="d506_10"/>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow>
				<mx:GridItem>
					<s:Label text="首字母"/><s:TextInput id="d506_05"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="起始编号"/><s:TextInput id="d506_06"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="终止编号"/><s:TextInput id="d506_07"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label text="调剂时间"/><mx:DateField id="d506_09" yearNavigationEnabled="true" width="128" dayNames='["日","一","二","三","四","五","六"]'
														monthNames='["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]'
														formatString="YYYY-MM-DD"/>
				</mx:GridItem>
			</mx:GridRow>
		</mx:Grid>
		<s:HGroup horizontalAlign="right" width="100%" paddingRight="10">
			<s:Button label="确认调剂" click="moveConfirm(event)"/>
		</s:HGroup>
	</s:VGroup>
</s:TitleWindow>
