<?xml version="1.0" encoding="utf-8"?>
<s:Module xmlns:fx="http://ns.adobe.com/mxml/2009"
		  xmlns:s="library://ns.adobe.com/flex/spark"
		  xmlns:mx="library://ns.adobe.com/flex/mx"
		  xmlns:component="com.xyw.sys.custom.component.*"
		  width="100%" height="100%" creationComplete="moduleComplete(event)">
	<fx:Declarations>
		<s:RemoteObject id="systemService" destination="systemService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="getComboBoxData" result="getComboBoxDataHandler(event)"/>
		</s:RemoteObject>
		<s:RemoteObject id="e301Service" destination="e301Service" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="queryE301" result="queryE301Handler(event)"/>
		</s:RemoteObject>
		<s:RemoteObject id="e701Service" destination="e701Service" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="saveE701" result="saveE701Handler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		mx|GridItem
		{
			horizontalAlign:left;
			verticalAlign:middle;
		}
		 
		s|TextInput
		{
			fontFamily:微软雅黑;
		}
		s|Label
		{
			fontSize:13;
		}
		s|Button
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomButtonSkin");
		}
		s|DropDownList
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomDropDownListSkin");
			selectionColor:#DDDDDD;
			rollOverColor:#EEEEEE;	
		}
		.must {
			color:red;
			fontSize:20px;
			fontWeight:bold;
			paddingTop:5px;
		}
		mx|ToolTip
		{
			fontSize:15;  
			color:#FF6699; 
		}
	</fx:Style>
	<fx:Script>
		<![CDATA[
			import com.xyw.module.etbj.etsl.model.E701;
			import com.xyw.module.etbj.model.E301Request;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.custom.component.CustomIcon;
			import com.xyw.sys.model.ComboBoxDataRequest;
			import com.xyw.sys.model.SystemUser;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			[Bindable]
			public var systemUser:SystemUser = null;
			private var comboBoxDataRequest:ComboBoxDataRequest;
			public var e701:E701;
			public var e301Request:E301Request;
			[Bindable]
			public var falg_query:Boolean=false;
			private var ve301:Object;
			private var countryIndex:int;
			private var jigouindex:int;
			
			private function moduleComplete(event:FlexEvent):void
			{
				this.systemUser = this.parentApplication.systemUser;
				//检查读卡权限
				if(this.systemUser.duka =="1"){
					this.duka1.enabled =true;
				}	
				var now:Date = new Date();
				this.e701_33.selectedDate =now;
				this.initializeComboBox();
				this.e701_19.addEventListener(FlexEvent.CHANGING,sete701_19);
				this.e701_19.addEventListener(FlexEvent.ENTER,sete701_19);
				this.e701_23.addEventListener(FlexEvent.CHANGING,sete701_23);
				this.e701_23.addEventListener(FlexEvent.ENTER,sete701_23);
			}
			public function sete701_19(event:Event):void{
				if(this.e701_18.selectedItem.data == 1){
					var cardId:String  = this.e701_19.text;
					if(cardId.length >= 16){
						var year:Number = Number(this.e701_19.text.substr(6,4));
						var month:Number = Number(this.e701_19.text.substr(10,2));
						var day:Number = Number(this.e701_19.text.substr(12,2));
						var date:Date = new Date();
						var nowDay:Number = date.date;
						var nowMonth:Number = date.month + 1;
						var nowYear:Number = date.fullYear;
						var age:Number;
						if(nowMonth < month){
							age = nowYear - year - 1;
						}else if(nowMonth == month){
							if(day > nowDay){
								age = nowYear - year -1;
							}else{
								age = nowYear - year;
							}
						}else if(nowMonth > month){
							age = nowYear - year;
						}
						this.e701_37.text = age + "";
						this.e701_36.text=CompMethod.getBirthday(cardId);
					}
				}
			}
			public function sete701_23(event:Event):void{
				if(this.e701_22.selectedItem.data == 1){
					var cardId:String  = this.e701_23.text;
					if(cardId.length >= 16){
						var year:Number = Number(this.e701_23.text.substr(6,4));
						var month:Number = Number(this.e701_23.text.substr(10,2));
						var day:Number = Number(this.e701_23.text.substr(12,2));
						var date:Date = new Date();
						var nowDay:Number = date.date;
						var nowMonth:Number = date.month + 1;
						var nowYear:Number = date.fullYear;
						var age:Number;
						if(nowMonth < month){
							age = nowYear - year - 1;
						}else if(nowMonth == month){
							if(day > nowDay){
								age = nowYear - year -1;
							}else{
								age = nowYear - year;
							}
						}else if(nowMonth > month){
							age = nowYear - year;
						}
						this.e701_42.text = age + "";
						this.e701_41.text=CompMethod.getBirthday(cardId);
					}
				}
			}
			private function initializeComboBox():void
			{
				comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.sql = "select t.d101_01, t.d101_02 from D101 t "; //where t.d101_01 ="+this.systemUser.institutionCode+"or t.d101_11 ="+this.systemUser.institutionCode;
				comboBoxDataRequest.flag = "D101";//单位
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
				
				this.comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.flag = "S301_01";//性别
				comboBoxDataRequest.sql = "select * from S301_01";
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
				
				this.comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.flag = "S301_03";//国籍
				comboBoxDataRequest.sql = "select * from S301_03";
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
				
				this.comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = true;
				comboBoxDataRequest.flag = "S301_04";//民族
				comboBoxDataRequest.sql = "select * from S301_04";
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
				
				comboBoxDataRequest =new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt =true;
				comboBoxDataRequest.sql ="select * from S301_06";
				comboBoxDataRequest.flag ="S301_06";	
				this.systemService..getComboBoxData(this.comboBoxDataRequest);
				
				comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = false;
				comboBoxDataRequest.sql = "select * from S301_10 where S_05='1' and S_04 ="+this.systemUser.userCode;
				comboBoxDataRequest.flag = "S301_10";
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
			}
			 
			private function getComboBoxDataHandler(event:ResultEvent):void
			{
				var comboBoxDataResponse:Object =  event.result;
				var flag:String = comboBoxDataResponse.flag;
				var comboBoxDataList:ArrayCollection = comboBoxDataResponse.comboBoxDataList;
				if(flag == "S301_01")//性别
				{
					comboBoxDataList.removeItemAt(4);
					comboBoxDataList.removeItemAt(4);
					comboBoxDataList.removeItemAt(4);
					comboBoxDataList.removeItemAt(4);
					this.e701_07.dataProvider = comboBoxDataList;
					this.e701_07.selectedIndex = 0;
				}else if(flag =="S301_03"){  //国籍
					countryIndex =this.getCountrySelectedIndex(comboBoxDataList);
					this.e701_10.dataProvider = comboBoxDataList;
					this.e701_10.selectedIndex = countryIndex;
					this.e701_38.dataProvider = comboBoxDataList;
					this.e701_38.selectedIndex = countryIndex;
					this.e701_43.dataProvider = comboBoxDataList;
					this.e701_43.selectedIndex = countryIndex;
				}else if(flag == "S301_04")//民族
				{
					this.e701_11.dataProvider = comboBoxDataList;
					this.e701_11.selectedIndex = 1;
					this.e701_39.dataProvider = comboBoxDataList;
					this.e701_39.selectedIndex = 1;
					this.e701_44.dataProvider = comboBoxDataList;
					this.e701_44.selectedIndex = 1;
				}else if(flag =="S301_06"){  //证件类型
					var TypeIndex:int =this.getDropDownListSelectedIndex(comboBoxDataList,"1");
					this.e701_18.dataProvider =comboBoxDataList;
					this.e701_18.selectedIndex =TypeIndex;
					this.e701_22.dataProvider =comboBoxDataList;
					this.e701_22.selectedIndex =TypeIndex;
				}else if(flag == "D101")//单位
				{
					jigouindex = this.getDropDownListSelectedIndex(comboBoxDataList, this.systemUser.institutionCode);
					this.e701_31.dataProvider = comboBoxDataList;
					this.e701_31.selectedIndex = jigouindex;
				}else if(flag=="S301_10"){
					this.e701_32.dataProvider = comboBoxDataList;
			//		this.e701_32.selectedIndex = 0;
				}
			}
			private function getDropDownListSelectedIndex(arrayCollection:ArrayCollection, defaultValue:String):int
			{
				var len:uint = arrayCollection.length;
				var i:uint = 0;
				var index:int = 0;
				while(i < len) {
					var comboBoxDataP:Object = arrayCollection.getItemAt(i);
					if(comboBoxDataP.data == defaultValue) {
						index = arrayCollection.getItemIndex(comboBoxDataP);
						break;
					}
					i++;
				}	
				return index;
			}
			/*-----------------默认国籍 中国---------------------*/
			private function getCountrySelectedIndex(arrayCollection:ArrayCollection):int
			{
				var len:uint = arrayCollection.length;
				var i:uint = 0;
				var index:int = 0;
				while(i < len) {
					var comboBoxDataP:Object = arrayCollection.getItemAt(i);
					if(comboBoxDataP.data == "CHN") {
						index = arrayCollection.getItemIndex(comboBoxDataP);
						break;
					}
					i++;
				}
				return index;
			}
			/**
			 *设置户口地址 
			 */
			private function e701_16_clickHandler(event:MouseEvent):void
			{
				
				e701_16.setAreaCode(e701_15.getAreaCode());
				
			}
			
			private function buclear(event:MouseEvent):void
			{
				clear(true);
			}
			
			private function savee701(event:MouseEvent):void
			{
				var bool:Boolean = validate1();
				if(!bool){
					return;
				}
				Alert.yesLabel = "确定";
				Alert.noLabel = "取消";
				Alert.show('确认保存？','保存信息',1|2,this,savee701_hanlder);
			}
			
			private function savee701_hanlder(event:CloseEvent):void{
				if(event.detail == Alert.YES){
					quzhi();
					e701Service.saveE701(e701);
				//	clear();
				}
			}
			//DateField.stringToDate(E702_70.text,'YYYY-MM-DD');
			private function quzhi():void{
				e701 = new E701();
				if(falg_query){
					this.e701.e70102 =ve301.e30101;
					this.e701.e70103=ve301.e30117;
				}
				e701.e70106=StringUtil.trim(e701_06.text);
				e701.e70108=StringUtil.trim(e701_08.text);
				e701.e70112=StringUtil.trim(e701_12.text);
				e701.e70113=StringUtil.trim(e701_13.text);
				if(validatef()){
					e701.e70121=StringUtil.trim(e701_21.text);
					e701.e70122=e701_22.selectedItem.data;
					e701.e70123=StringUtil.trim(e701_23.text);
					e701.e70130=StringUtil.trim(e701_30.text);
					e701.e70141=DateField.stringToDate(e701_41.text,'YYYY-MM-DD');
					e701.e70142=StringUtil.trim(e701_42.text);
					e701.e70143=e701_43.selectedItem.data;
					e701.e70144=e701_44.selectedItem.data;
					e701.e70145=StringUtil.trim(e701_45.text);
				}
				if(validatem()){
					e701.e70117=StringUtil.trim(e701_17.text);
					e701.e70118=e701_18.selectedItem.data;
					e701.e70119=StringUtil.trim(e701_19.text);
					e701.e70120=StringUtil.trim(e701_20.text);
					e701.e70136=DateField.stringToDate(e701_36.text,'YYYY-MM-DD');
					e701.e70137=StringUtil.trim(e701_37.text);
					e701.e70138=e701_38.selectedItem.data;
					e701.e70139=e701_39.selectedItem.data;
					e701.e70140=StringUtil.trim(e701_40.text);
				}
				e701.e70107=e701_07.selectedItem.data;
				e701.e70109=DateField.stringToDate(e701_09.text,'YYYY-MM-DD');
				e701.e70110=e701_10.selectedItem.data;
				e701.e70111=e701_11.selectedItem.data;
				e701.e70115=e701_15.getAreaCode();
				e701.e70116=e701_16.getAreaCode();
				e701.e70132=StringUtil.trim(e701_32.text);;
				e701.e70131=e701_31.selectedItem.data;
				e701.e70133=DateField.stringToDate(e701_33.text,'YYYY-MM-DD');
				
			}
			
			private function validate1():Boolean
			{
				if(StringUtil.trim(e701_06.text)==""){
					Alert.show("请输入儿童的姓名","系统提示");
					return false;
				}
				if(this.e701_07.selectedItem.data == 0){
					Alert.show("请选择儿童性别!","系统提示");
					return false;
				}
				
				if(this.e701_09.text ==""){
					Alert.show("请输入儿童的出生日期","系统提示");
					return false;
				}
				if(this.e701_10.selectedItem.data == 0){
					Alert.show("请选择国籍!","系统提示");
					return false;
				}
				if(this.e701_11.selectedItem.data == 0){
					Alert.show("请选择民族!","系统提示");
					return false;
				}
				
				if(StringUtil.trim(e701_13.text)!=""){
					var e13:Number = new Number(StringUtil.trim(e701_13.text));
					if(e13<30||e13>200){
						Alert.show("不合理的身高","系统提示");
						return false;
					}
				}
			
				if(StringUtil.trim(e701_12.text)!=""){
					var e12:Number = new Number(StringUtil.trim(e701_12.text));
					if(e12<2||e12>100){
						Alert.show("不合理的体重","系统提示");
						return false;
					}
				}
				
				if(StringUtil.trim(this.e701_08.text)!=""){
					var patternMonther3:RegExp = /^(\d{18,18}|\d{15,15}|\d{17,17}X|\d{17,17}x)$/g;
					if(!patternMonther3.test(this.e701_08.text))
					{	//只有在证件类别为身份证，国籍为中国的时候才验证身份证格式是否正确
						Alert.show("儿童证件号码有误!","系统提示");
						return false;
					}
				}
				if(e701_15.getAreaCode().substr(0,4)!="4113")
				{
					Alert.show("现地址请选择南阳市地址","系统提示");
					return false;
				}
				if(!CompMethod.validateAreaCode(e701_15.getAreaCode(),'4113'))
				{
					Alert.show("现地址选择到最下级","系统提示");
					return false;
				}
				if(e701_16.getAreaCode().substr(0,4)=="4113"){
					if(!CompMethod.validateAreaCode(e701_16.getAreaCode(),"4113"))
					{
						Alert.show("户口地址选择到最下级","系统提示");
						return false;
					}
				}else{
					if(!CompMethod.validateAreaCode(e701_16.getAreaCode(),"4113",true))
					{
						Alert.show("户口地址选择到乡镇","系统提示");
						return false;
					}
				}
				if(!validatefm()){
					Alert.show("父母信息必须有一方填写完整","系统提示");
					return false;	
				}
				var num_:Number=validatef()?(validatem()?3:1):(validatem()?2:0);
				if(num_==1||num_==3){
					if(this.e701_22.selectedItem.data == 1&&StringUtil.trim(this.e701_23.text)!=""){
						var patternMonther1:RegExp = /^(\d{18,18}|\d{15,15}|\d{17,17}X|\d{17,17}x)$/g;
						if(this.e701_22.selectedItem.data == 1 &&  !patternMonther1.test(this.e701_23.text))
						{	//只有在证件类别为身份证，国籍为中国的时候才验证身份证格式是否正确
							Alert.show("父亲证件号码有误!","系统提示");
							return false;
						}
					}
					var patternPhonef:RegExp = /^1(3|4|5|6|7|8|9)\d{9}$/;
					if(StringUtil.trim(e701_30.text)!=""&&!patternPhonef.test(e701_30.text)){
						Alert.show("父亲联系电话不正确!","系统提示");
						return false;
					}
				}
				if(num_==2||num_==3){
					if(this.e701_18.selectedItem.data == 1&&StringUtil.trim(this.e701_19.text)!=""){
						var patternMonther:RegExp = /^(\d{18,18}|\d{15,15}|\d{17,17}X|\d{17,17}x)$/g;
						if(this.e701_18.selectedItem.data == 1 &&  !patternMonther.test(this.e701_19.text))
						{	//只有在证件类别为身份证，国籍为中国的时候才验证身份证格式是否正确
							Alert.show("母亲证件号码有误!","系统提示");
							return false;
						}
					}
					var patternPhonem:RegExp = /^1(3|4|5|6|7|8|9)\d{9}$/;
					if(StringUtil.trim(e701_20.text)!=""&&!patternPhonem.test(e701_20.text)){
						Alert.show("母亲联系电话不正确!","系统提示");
						return false;
					}
				}
				
				if(num_==1&&!vam()){
					if(StringUtil.trim(e701_17.text)==""){
						Alert.show("请完善母亲姓名信息或清除母亲其他相关信息","系统提示");
						return false;
					}
					if(this.e701_18.selectedItem.data == 0){
						Alert.show("请完善母亲证件类型信息或清除母亲其他相关信息!","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_19.text)==""){
						Alert.show("请完善母亲证件号码信息或清除母亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_20.text)==""){
						Alert.show("请完善母亲联系电话信息或清除母亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_36.text)==""){
						Alert.show("请完善母亲出生日期信息或清除母亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_37.text)==""){
						Alert.show("请完善母亲年龄信息或清除母亲其他相关信息","系统提示");
						return false;
					}
					if(this.e701_38.selectedItem.data == 0){
						Alert.show("请完善母亲国籍信息或清除母亲其他相关信息!","系统提示");
						return false;
					}
					if(this.e701_39.selectedItem.data == 0){
						Alert.show("请完善母亲民族信息或清除母亲其他相关信息!","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_40.text)==""){
						Alert.show("请完善母亲证件地址信息或清除母亲其他相关信息","系统提示");
						return false;
					}
				}
				if(num_==2&&!vaf()){
					if(StringUtil.trim(e701_21.text)==""){
						Alert.show("请完善父亲姓名信息或清除父亲其他相关信息","系统提示");
						return false;
					}
					if(this.e701_22.selectedItem.data == 0){
						Alert.show("请完善父亲证件类型信息或清除父亲其他相关信息!","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_23.text)==""){
						Alert.show("请完善父亲证件号码信息或清除父亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_30.text)==""){
						Alert.show("请完善父亲联系电话信息或清除父亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_41.text)==""){
						Alert.show("请完善父亲出生日期信息或清除父亲其他相关信息","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_42.text)==""){
						Alert.show("请完善父亲年龄信息或清除父亲其他相关信息","系统提示");
						return false;
					}
					if(this.e701_43.selectedItem.data == 0){
						Alert.show("请完善父亲国籍信息或清除父亲其他相关信息!","系统提示");
						return false;
					}
					if(this.e701_44.selectedItem.data == 0){
						Alert.show("请完善父亲民族信息或清除父亲其他相关信息!","系统提示");
						return false;
					}
					if(StringUtil.trim(e701_45.text)==""){
						Alert.show("请完善父亲证件地址信息或清除父亲其他相关信息","系统提示");
						return false;
					}
				}
				if(StringUtil.trim(e701_32.text)==""||StringUtil.trim(e701_32.text)=="选择")
				{
					Alert.show("请输入录入人员信息","系统提示");
					return false;
				}
				
				return true;
			}
			private function vam():Boolean{
				if(StringUtil.trim(e701_17.text)==""&&StringUtil.trim(e701_19.text)==""&&StringUtil.trim(e701_20.text)==""&&StringUtil.trim(e701_36.text)==""&&StringUtil.trim(e701_37.text)==""&&StringUtil.trim(e701_40.text)==""){
					return true;
				}
				return false;
			}
			private function vaf():Boolean{
				if(StringUtil.trim(e701_21.text)==""&&StringUtil.trim(e701_23.text)==""&&StringUtil.trim(e701_30.text)==""&&StringUtil.trim(e701_41.text)==""&&StringUtil.trim(e701_42.text)==""&&StringUtil.trim(e701_45.text)==""){
					return true;
				}
				return false;
			}
			private function validatefm():Boolean{
				if(validatef()||validatem()){
					return true;
				}
				return false;
			}
			
			private function validatef():Boolean{
				if(StringUtil.trim(e701_21.text)==""){
					return false;
				}
				if(this.e701_22.selectedItem.data == 0){
					return false;
				}
				if(StringUtil.trim(e701_23.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_30.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_41.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_42.text)==""){
					return false;
				}
				if(this.e701_43.selectedItem.data == 0){
					return false;
				}
				if(this.e701_44.selectedItem.data == 0){
					return false;
				}
				if(StringUtil.trim(e701_45.text)==""){
					return false;
				}
				return true;
			}
			
			private function validatem():Boolean{
				if(StringUtil.trim(e701_17.text)==""){
					return false;
				}
				if(this.e701_18.selectedItem.data == 0){
					return false;
				}
				if(StringUtil.trim(e701_19.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_20.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_36.text)==""){
					return false;
				}
				if(StringUtil.trim(e701_37.text)==""){
					return false;
				}
				if(this.e701_38.selectedItem.data == 0){
					return false;
				}
				if(this.e701_39.selectedItem.data == 0){
					return false;
				}
				if(StringUtil.trim(e701_40.text)==""){
					return false;
				}
				return true;
			}
			
			private function queryfnwcdj():void
			{
				if(StringUtil.trim(this.e301_26.text)==""){
					Alert.show("请输入母亲姓名！","系统提示");
					return;
				}
				if(StringUtil.trim(this.e301_27.text)==""){
					Alert.show("请输入母亲证件号码！","系统提示");
					return;
				}
				e301Request=new E301Request();
				initQueryParam();
				
				e301Request.parameterPageindex = 1;
				e301Request.parameterPagesize = 3;
				this.e301Service.queryE301(e301Request);
			}
			private function initQueryParam():void
			{
				
				this.currentState="special";
				e301Request.f30102 =StringUtil.trim(this.e301_26.text);
				e301Request.f30105 =StringUtil.trim(this.e301_27.text);
			}
			
			public function saveE701Handler(event:ResultEvent):void{
				var response:Object = event.result;
				if(response.falg){
					Alert.show("保存成功","系统提示");
					clear(true);
				}else{
					if(response.state==1){
						Alert.show("已经存在档案,不能重复保存","系统提示");
						return;
					}
					Alert.show("保存出错,请重试");
				}
			}
			
			private function clear(bool:Boolean):void{
				if(bool){
					this.e301_26.text="";
					this.e301_27.text="";
				}
				this.e701_06.text = "";
				this.e701_08.text = "";
				this.e701_09.text = "";
				this.e701_12.text = "";
				this.e701_13.text = "";
				this.e701_17.text = "";
				this.e701_19.text = "";
				this.e701_20.text = "";
				this.e701_21.text = "";
				this.e701_23.text = "";
				this.e701_30.text = "";
				e701_15.setAreaCode(this.systemUser.areaCode);
				e701_16.setAreaCode(this.systemUser.areaCode);
				this.e701_07.selectedIndex=0;
				this.e701_10.selectedIndex=countryIndex;
				this.e701_11.selectedIndex=1;
				this.e701_18.selectedIndex=1;
				this.e701_22.selectedIndex=1;
				this.e701_32.selectedIndex=0;
				this.e701_36.text="";
				this.e701_37.text="";
				this.e701_38.selectedIndex=countryIndex;
				this.e701_39.selectedIndex=1;
				this.e701_40.text="";
				this.e701_41.text="";
				this.e701_42.text="";
				this.e701_43.selectedIndex=countryIndex;
				this.e701_44.selectedIndex=1;
				this.e701_45.text="";
				falg_query=false;
			}
			private function buclearf():void{
				this.e701_21.text = "";
				this.e701_23.text = "";
				this.e701_30.text = "";
				this.e701_22.selectedIndex=1;
				this.e701_41.text="";
				this.e701_42.text="";
				this.e701_43.selectedIndex=countryIndex;
				this.e701_44.selectedIndex=1;
				this.e701_45.text="";
			}
			private function buclearm():void{
				this.e701_17.text = "";
				this.e701_19.text = "";
				this.e701_20.text = "";
				this.e701_18.selectedIndex=1;
				this.e701_36.text="";
				this.e701_37.text="";
				this.e701_38.selectedIndex=countryIndex;
				this.e701_39.selectedIndex=1;
				this.e701_40.text="";
			}
			private function queryE301Handler(event:ResultEvent):void{
				var e301Response:Object = event.result;
				var rowCount:Number = e301Response.rowCount;
				if(e301Response.state){
					this.pagerBar.dataGrid = this.certificateDataGrid;
					this.pagerBar.rowCount = rowCount;
					this.pagerBar.resultData = e301Response.ve301s;
					this.pagerBar.dataBind();
					this.pagerBar.pagerFunction = pagerFunction;
					if(rowCount > 0) {
						this.pagerBar.enabled = true;
					}else{
						Alert.show("暂无数据!","系统提示");
					}
					this.certificateDataGrid.dataProvider = e301Response.ve301s;
					falg_query=false;
					this.ve301 = null;
				}else{
					Alert.show(e301Response.errorMessage,"系统提示");
				}
			}
			
			private function pagerFunction(currentPageIndex:int, pageSize:int):void
			{
				if(StringUtil.trim(this.e301_26.text)==""){
					Alert.show("请输入母亲姓名！","系统提示");
				}
				if(StringUtil.trim(this.e301_27.text)==""){
					Alert.show("请输入母亲证件号码！","系统提示");
				}
				e301Request=new E301Request();
				this.initQueryParam();
				e301Request.parameterPageindex = currentPageIndex;
				e301Request.parameterPagesize = pageSize;
				this.e301Service.queryE301(e301Request);
			}
			
			private function onSelected(event:Event):void{
				this.ve301 = DataGrid(event.target).selectedItem;
				clear(false);
				this.loadE301(this.ve301);
				
				if(ve301.f30106Str==""||ve301.f30106Str==null||e701_37.text==""){
					sete701_19(new Event("d"));
				}
				if(ve301.f30122Str==""||ve301.f30122Str==null||e701_42.text==""){
					sete701_23(new Event("d"));
				}
				this.currentState="";
//				Alert.show("e701_36.text>>>"+e701_36.text);
//				Alert.show("e701_33.text>>>"+e701_33.text);
//				Alert.show("ve301.f30106>>"+ve301.f30106);
//				Alert.show("ve301.f30122>>"+ve301.f30122);
			}
			
			public function loadE301(ve301:Object):void
			{
				falg_query=true;
			//	this.e701.e701_02 =ve301.e30101;
				this.e701_06.text=ve301.e30103;
				if(ve301.e30105!=""&&ve301.e30105!="无"){
					this.e701_08.text=ve301.e30105;
				}
			//	this.e701_09.selectedDate=ve301.e30106;
				this.e701_09.text = ve301.e30106Str;
				if(ve301.e30119!="0"){
					this.e701_12.text=ve301.e30119;
				}
				if(ve301.e30130!="0"){
					this.e701_13.text=ve301.e30130;
				}
				this.e701_17.text=ve301.f30102;
				
				setIndex(e701_18,ArrayCollection(this.e701_18.dataProvider),ve301.f30104);
				setIndex(e701_22,ArrayCollection(this.e701_22.dataProvider),ve301.f30120);
				setIndex(e701_38,ArrayCollection(this.e701_38.dataProvider),ve301.f30108);
				setIndex(e701_39,ArrayCollection(this.e701_39.dataProvider),ve301.f30109);
				setIndex(e701_43,ArrayCollection(this.e701_43.dataProvider),ve301.f30124);
				setIndex(e701_44,ArrayCollection(this.e701_44.dataProvider),ve301.f30125);
				setIndex(e701_07,ArrayCollection(this.e701_07.dataProvider),ve301.e30104);
				setIndex(e701_10,ArrayCollection(this.e701_10.dataProvider),ve301.e30107);
				setIndex(e701_11,ArrayCollection(this.e701_11.dataProvider),ve301.e30108);
				
				this.e701_19.text=ve301.f30105;
				this.e701_20.text=ve301.f30113;
				this.e701_21.text=ve301.f30118;
				this.e701_23.text=ve301.f30121;
				this.e701_30.text=ve301.f30128;
				
				this.e701_36.text=ve301.f30106Str;
			//	this.e701_36.selectedDate=creatdate(ve301.f30106Str);
				if(ve301.f30107!="0"){
					this.e701_37.text=ve301.f30107;
				}
				this.e701_40.text=ve301.f30110;
				this.e701_41.text=ve301.f30122Str;
			//	this.e701_41.selectedDate=creatdate(ve301.f30122Str);
				if(ve301.f30123!="0"){
					this.e701_42.text=ve301.f30123;
				}
				this.e701_45.text=ve301.f30126;
				
				
				if(ve301.e30109!=""){
					e701_16.setAreaCode(ve301.e30109);
				}
				if(ve301.e30112!=""){
					e701_15.setAreaCode(ve301.e30112);
				}
			}
			
			
			public function setIndex(drop:DropDownList,array:ArrayCollection,str:String):void{
				if(str!=null&&str!=""){
					drop.selectedIndex=CompMethod.getDropDownListSelectedIndex(array,str);
				}
			}
			
			protected function readCard_B(event:MouseEvent):void
			{
				try
				{
					var array:Array = CompMethod.read_card("女");//性别
					if(!array)
						return ;
					this.e301_26.text = array[0];//姓名
					this.e301_27.text = array[5];//身份证号
						//	queryfnwcdj();
				} 
				catch(error:Error) 
				{
					Alert.show("读卡失败！");
				}
			}
			protected function readCard_B2(event:MouseEvent):void
			{
				try
				{
					var array:Array = CompMethod.read_card("女");//性别
					if(!array)
						return ;
					this.e701_18.selectedIndex=1;
					this.e701_17.text = array[0];//姓名
					this.e701_36.text = array[3];//出生日期
					this.e701_19.text = array[5];//身份证号
					this.e701_40.text = array[4];//户口地址
							
					e701_37.text=CompMethod._getAge(DateField.stringToDate(array[3],"YYYY-MM-DD"));
					e701_39.selectedIndex=CompMethod.getDropDownListSelectedIndex(ArrayCollection(e701_39.dataProvider),array[2],true);
				} 
				catch(error:Error) 
				{
					Alert.show("读卡失败！");
				}
			}
			
			protected function readCard_B3(event:MouseEvent):void
			{
				try
				{
					var array:Array = CompMethod.read_card("男");//性别
					if(!array)
						return ;
					this.e701_22.selectedIndex=1;
					this.e701_21.text = array[0];//姓名
					this.e701_41.text = array[3];//出生日期
					this.e701_23.text = array[5];//身份证号
					this.e701_45.text = array[4];//户口地址
							
					e701_42.text=CompMethod._getAge(DateField.stringToDate(array[3],"YYYY-MM-DD"));
					e701_44.selectedIndex=CompMethod.getDropDownListSelectedIndex(ArrayCollection(e701_44.dataProvider),array[2],true);
				} 
				catch(error:Error) 
				{
					Alert.show("读卡失败！");
				}
			}
			private function setStringDate(item:Object, column:GridColumn):String
			{
				var date:Date=item[column.dataField];
				return DateField.dateToString(date,"YYYY-MM-DD");
			}
		]]>
	</fx:Script>
	
	<s:states>
		<s:State name="normal"/>			
		<s:State name="special"/>
	</s:states>
	
	<s:Scroller id="no1" width="100%" height="100%" horizontalScrollPolicy="auto"
				verticalScrollPolicy="auto">
		<s:VGroup id="no2" paddingBottom="20" paddingLeft="10" paddingRight="10" paddingTop="10">
			
			<mx:TabNavigator width="1134" height="173" chromeColor="#ffffff" creationPolicy="all"
							 width.normal="1135" height.normal="68"
							 height.special="68">
				<s:NavigatorContent width="100%" label="儿童档案查询" >	
					
					<s:VGroup paddingBottom="2" paddingLeft="6" paddingRight="5">	
						<s:HGroup width="100%" height="100%" verticalAlign="middle" paddingBottom="0">
								<s:Label text="请输入母亲姓名" paddingLeft="1"/><s:TextInput id="e301_26"/>
								<s:Label text="母亲证件号码" /><s:TextInput id="e301_27" width="170"/>
								<s:Button click="queryfnwcdj()" label="查询"/>	
								<s:Button label="读卡" id="duka1" enabled="{systemUser.duka=='1'}" click="readCard_B(event)" icon="{CustomIcon.READCARD}"/>
						</s:HGroup>
					</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
					
			<s:VGroup id="vgroupDataGrid" height="128" includeIn="special" itemDestructionPolicy="auto" paddingRight="5" width.special="1134">
				<s:DataGrid id="certificateDataGrid" height="96"
							alternatingRowColors="[#FFFFFF,#EEEEEE]" editable="false" rowHeight="22"
							selectionChange="onSelected(event)"
							width.special="1134" height.special="92">
					<s:columns>
						<s:ArrayList>
							<s:GridColumn width="40" editable="false" headerText="序号" itemRenderer="com.xyw.sys.custom.itemrenderer.CustomGridColumnItemRenderer"/>
							<s:GridColumn width="80" dataField="e30103" headerText="儿童姓名"/>
							<s:GridColumn width="150" dataField="e30105" headerText="身份证号"/>
							<s:GridColumn width="100" dataField="e30106" headerText="出生日期" labelFunction="setStringDate" />
							<s:GridColumn width="70" dataField="e30126" headerText="母亲姓名"/>
							<s:GridColumn width="130" dataField="e30127" headerText="母亲身份证号"/>
							<s:GridColumn width="100" dataField="e30111" headerText="联系方式"/>
							<s:GridColumn width="150" dataField="e30117" headerText="保健卡号"/>
							<s:GridColumn width="100" dataField="e30114" headerText="建档日期" labelFunction="setStringDate" />
							<s:GridColumn dataField="e30116Zh" headerText="建档单位"/>
						</s:ArrayList>
					</s:columns>
				</s:DataGrid>					
				<component:PagerBar id="pagerBar" enabled="false" isExcel="false" isExcel2="false" isPrinter="false"/>
			</s:VGroup>
			
			<mx:TabNavigator width="1134" chromeColor="#ffffff" creationPolicy="all">
				<s:NavigatorContent width="100%" label="儿童信息">
					<s:VGroup paddingBottom="2" paddingLeft="5" paddingRight="10">	
					<mx:Grid paddingLeft="1" paddingBottom="1">
						<mx:GridRow>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="儿童姓名"/>
								<s:TextInput id="e701_06" width="130"/>
								<s:Label text="*" styleName="must"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="性　   别"/>
								<s:DropDownList id="e701_07" width="130"/>
								<s:Label text="*" styleName="must"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label text="出生日期" paddingLeft="2"/>
								<component:CustomRangeDateField id="e701_09"/>
								<s:Label text="*" styleName="must"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="国　   籍"/>
								<s:DropDownList id="e701_10" width="170"/>
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label text="民　   族" paddingLeft="2"/>
								<s:DropDownList id="e701_11" width="130"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="身高(cm)"/>
								<s:TextInput id="e701_13" restrict="0-9"  width="130" maxChars="6"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="体重 (kg)"/>
								<s:TextInput id="e701_12" restrict="0-9." maxChars="6"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label text="身份证号" paddingLeft="2"/>
								<s:TextInput id="e701_08" width="170"/>
							</mx:GridItem>
						</mx:GridRow>
					</mx:Grid>
					<s:HGroup width="100%" height="100%" paddingBottom="5" verticalAlign="middle">
						<s:Label width="57" paddingLeft="2" text="现  住  址"/>
						<component:AreaComboBoxVillageAuto id="e701_15" width="844" buttonMode="true" table="D201_MS" areaCode="{this.parentApplication.systemUser.areaCode}"/>
					</s:HGroup>
					<s:HGroup width="100%" height="100%" paddingBottom="5" verticalAlign="middle">
						<s:Label width="57" paddingLeft="2" text="户口地址"/>
						<component:AreaComboBoxVillageAuto id="e701_16" width="844" buttonMode="true" table="D201_MS" areaCode="{this.parentApplication.systemUser.areaCode}"/>
						<s:Button label="同现住址" click="e701_16_clickHandler(event)" buttonMode="true"/>
					</s:HGroup>
					</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
			<mx:TabNavigator width="1134" chromeColor="#ffffff" creationPolicy="all">
				<s:NavigatorContent width="100%" label="父母信息">
					<s:VGroup paddingBottom="2" paddingLeft="5" paddingRight="10">	
					<s:HGroup width="100%" paddingBottom="5" paddingLeft="10"
							  paddingRight="10" verticalAlign="middle">
						
						<s:Label id="lbl" color="#FD0909"
								 fontSize="16"
								 text="!  注意：父母信息至少一方信息填写完整"/>
					</s:HGroup>
					<mx:Grid paddingBottom="10" paddingLeft="0"
							 width.special="1119">
						<mx:GridRow>
							<mx:GridItem>
								<s:Label paddingLeft="3" text="母亲姓名"/>
								<s:TextInput id="e701_17" width="120"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label text="证件类别" paddingLeft="1"/>
								<s:DropDownList id="e701_18" width="130"/>
							</mx:GridItem>
							<mx:GridItem width="258">
								<s:Label text="证件号码" paddingLeft="1"/>
								<s:TextInput id="e701_19" width="197"/>
							</mx:GridItem>
							<mx:GridItem width="217">
								<s:Label text="出生日期" paddingLeft="1"/>
								<component:CustomRangeDateField id="e701_36" width="146"/>
							</mx:GridItem>
							<mx:GridItem width.special="229">
								<s:Label text="年　　龄" paddingLeft="1"/>
								<s:TextInput id="e701_37" restrict="0-9" width="169" maxChars="2"/>
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label paddingLeft="4" text="国      籍"/>
								<s:DropDownList id="e701_38" width="120"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="民      族"/>
								<s:DropDownList id="e701_39" width="130"/>
							</mx:GridItem>
							<mx:GridItem width="258">
								<s:Label text="联系电话" paddingLeft="2"/>
								<s:TextInput id="e701_20" width="196"/>
							</mx:GridItem>
							<mx:GridItem colSpan="2">	
								<s:Label paddingLeft="1" text="证件地址"/>
								<s:TextInput id="e701_40" width="318"/>
								<s:Button label="读卡" id="duka2" click="readCard_B2(event)" icon="{CustomIcon.READCARD}" enabled="{systemUser.duka=='1'}"/>
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label paddingLeft="3" text="父亲姓名"/>
								<s:TextInput id="e701_21" width="118"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label text="证件类别" paddingLeft="1"/>
								<s:DropDownList id="e701_22" width="130"/>
							</mx:GridItem>
							<mx:GridItem width="258">
								<s:Label text="证件号码" paddingLeft="1"/>
								<s:TextInput id="e701_23" width="197"/>
							</mx:GridItem>
							<mx:GridItem width="217">
								<s:Label text="出生日期" paddingLeft="1"/>
								<component:CustomRangeDateField id="e701_41" width="146"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label text="年　　龄" paddingLeft="1"/>
								<s:TextInput id="e701_42" restrict="0-9" width="169" maxChars="2"/>
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow>
							<mx:GridItem>
								<s:Label paddingLeft="4" text="国      籍"/>
								<s:DropDownList id="e701_43" width="119"/>
							</mx:GridItem>
							<mx:GridItem>
								<s:Label paddingLeft="2" text="民      族"/>
								<s:DropDownList id="e701_44" width="130"/>
							</mx:GridItem>
							<mx:GridItem width="258">
								<s:Label text="联系电话" paddingLeft="2"/>
								<s:TextInput id="e701_30" width="196"/>
							</mx:GridItem>
							<mx:GridItem colSpan="2">	
								<s:Label paddingLeft="1" text="证件地址"/>
								<s:TextInput id="e701_45" width="318"/>
								<s:Button label="读卡" id="duka3" click="readCard_B3(event)" icon="{CustomIcon.READCARD}" enabled="{systemUser.duka=='1'}"/>
							</mx:GridItem>
						</mx:GridRow>
					</mx:Grid>
		</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
			<mx:TabNavigator width="1134" chromeColor="#ffffff" creationPolicy="all"
							 width.normal="1133">
				<s:NavigatorContent width="100%" label="录入信息">			
					<s:VGroup paddingBottom="2" paddingLeft="5" paddingRight="10">	
						<s:HGroup width="100%" height="100%" paddingBottom="5" verticalAlign="middle">
							<s:Label text="录入单位"/><s:DropDownList id="e701_31" width="130"
																  enabled="false"
																  width.normal="154"/>
							<s:Label text="录入人员"/><component:FindSelectedItemComboBox editable="true" height="21"  width="130" id="e701_32"/>
							<s:Label text="录入时间"/>
							<component:CustomRangeDateField  id="e701_33" enabled="false" isSelectNow="true"/>
							
						</s:HGroup>
					</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
			<s:HGroup width="1134" height="30" contentBackgroundColor="#FF0000"
					  horizontalAlign="center" paddingBottom="20" paddingLeft="10" paddingTop="10"
					  verticalAlign="middle">
				<s:Button label="保存" buttonMode="true" id="save" enabled="{falg_query}" click="savee701(event)"/>
				<s:Button label="清空全部" buttonMode="true" id="clear_bu"  click="buclear(event)"/>
				<s:Button label="清空父亲" buttonMode="true" id="clear_buf"  click="buclearf()"/>
				<s:Button label="清空母亲" buttonMode="true" id="clear_bum"  click="buclearm()"/>
			</s:HGroup>
		</s:VGroup>
	</s:Scroller>
</s:Module>
