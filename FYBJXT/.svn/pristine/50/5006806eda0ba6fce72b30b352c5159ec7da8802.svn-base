<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx" width="702" height="204" xmlns:component="com.xyw.sys.custom.component.*" 
		  backgroundColor="white"
		  chromeColor="#5CACEE" close="closeHandler()" cornerRadius="5" horizontalCenter="0"
		  title="任务数" creationComplete="creationCompleteHandler(event)">
	<fx:Declarations>
		<s:RemoteObject id="rwsService" destination="rwsService"
						endpoint="{this.parentApplication.contextRoot}/messagebroker/amf"
						showBusyCursor="true">
			<s:method name="addRws" result="saveOrRenewRwsHandler(event)"/>
			<s:method name="updateRws" result="saveOrRenewRwsHandler(event)"/>
		</s:RemoteObject>	
		<s:RemoteObject id="systemService" destination="systemService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="getComboBoxData" result="getComboBoxDataHandler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		.myLabel
		{
			paddingTop:4px;
			fontSize:12px;
		}
		mx|GridItem
		{
			horizontalAlign:left;
			verticalAlign:middle;
		}
		s|Label 
		{
			fontSize:12px;
		}
		mx|GridItem
		{
			horizontalAlign:left;
			verticalAlign:middle;
		}
		s|TextInput
		{
			fontFamily:微软雅黑;
		}
		s|Button
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomButtonSkin");
		}
		s|DropDownList
		{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomDropDownListSkin");
			selectionColor:#DDDDDD;
			rollOverColor:#EEEEEE;	
		}
		.must 
		{
			color:red;
			fontSize:20px;
			fontWeight:bold;
			paddingTop:5px;
		}
		
		.pf8
		{
			paddingLeft:8px;
		}
		.textInput{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomTextInputSkin");
		}  
	</fx:Style>
	<fx:Script>
		<![CDATA[
			import com.as3xls.xls.Type;
			import com.xyw.module.rws.model.Rws;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.model.ComboBoxDataRequest;
			import com.xyw.sys.model.SystemUser;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			
			public var modify:Boolean=false;
			
			public var rws03:String="2";
			public var rws06:String="1";
			public var rws:Rws;
			public var vrws:Object;
			private var comboBoxDataRequest:ComboBoxDataRequest;	
			public var systemUser:SystemUser = null;
			
			private function save_clickHandler(event:MouseEvent):void
			{
				if(isNaN(rws02.value))
				{
					Alert.show("请输入一个合理的年份","系统提示");
					return;
				}
				var date:Date = new Date();
				var fullYear:Number = date.fullYear;
				if(rws02.value<fullYear)
				{
					Alert.show("不能将年份设置为过去的年份","系统提示");
					return;
				}
				if(!rws07.text)
				{
					Alert.show("请输入任务数","系统提示");
					return;
				}
				
				if(StringUtil.trim(rws09.text)=="")
				{
					Alert.show("请输入录入人","系统提示");
					return;
				}
				
				saveRws();
			}
			
			/**
			 *
			 */
			private function saveRws():void
			{
				save.enabled=false;
				rws = new Rws();
				rws.rws02=rws02.value;
				rws.rws03=rws03;
				rws.rws04=rws05.selectedItem.label;
				rws.rws05=rws05.selectedItem.data;
				rws.rws06=rws06;
				rws.rws07=StringUtil.trim(rws07.text);
				rws.rws08=rws08.selectedItem.data;
				rws.rws09=StringUtil.trim(rws09.text);
				rws.rws10=DateField.stringToDate(rws10.text,"YYYY-MM-DD");
				rws.rws11=this.parentApplication.systemUser.userCode;
				if(modify)
				{
					rws.rws01=vrws.rws01;
					rws.rws12=vrws.rws12;
					rwsService.updateRws(rws);	
				}else
					rwsService.addRws(rws);
				
			}
			
			private function saveOrRenewRwsHandler(event:ResultEvent):void{ 
				CompMethod.CUDHandler(
					event.result,['errorMessage',modify?"修改":"保存"],
					function():void{
						closeHandler();
					},save);
			}
			
			private function closeHandler():void
			{
				dispatchEvent(new Event("ok_click"));
				PopUpManager.removePopUp(this);
			}
			
			private function creationCompleteHandler(event:FlexEvent):void
			{	
				this.systemUser = this.parentApplication.systemUser;
				this.initializeComboBox();
				CompMethod.getDefaultCode([rws08,rws05]);
				if(!modify)
				{
					this.title+="登记";
					
				}else
				{
					this.title+="修改";
					updateRws();				
				}
				var date:Date = new Date();
				var fullYear:Number = date.fullYear;
				rws02.value = fullYear;
			}
			private function initializeComboBox():void
			{
				comboBoxDataRequest = new ComboBoxDataRequest();
				comboBoxDataRequest.showPrompt = false;
				comboBoxDataRequest.sql = "select * from S301_10 where S_05='1' and S_04 ="+this.systemUser.userCode;
				comboBoxDataRequest.flag = "S301_10";
				this.systemService.getComboBoxData(this.comboBoxDataRequest);
			}
			private function getComboBoxDataHandler(event:ResultEvent):void
			{
				var comboBoxDataResponse:Object =  event.result;
				var flag:String = comboBoxDataResponse.flag;
				var comboBoxDataList:ArrayCollection = comboBoxDataResponse.comboBoxDataList;
				if(flag == "S301_10")
				{
					this.rws09.dataProvider = comboBoxDataList;
					if(!modify)
					{
						this.rws09.selectedIndex = 0;
					}
					
				}
			}
			private function updateRws():void
			{
				rws02.value=vrws.rws02;
				rws07.text=vrws.rws07;
				rws09.prompt=vrws.rws09;
				rws10.selectedDate=vrws.rws10;
			}
		]]>
	</fx:Script>
	<s:Scroller x="0" width="694" height="176" chromeColor="#ffffff" horizontalScrollPolicy="auto"
				verticalScrollPolicy="auto">
		<s:VGroup horizontalAlign="center" paddingTop="5" paddingLeft="10" paddingRight="10" >
			<s:VGroup x="11" width="672">
				
				
				<mx:TabNavigator width="100%" chromeColor="#ffffff" creationPolicy="all" paddingBottom="7">
					<s:NavigatorContent width="100%" label="儿童信息">
						<mx:Grid paddingLeft="10" paddingRight="10">
							<mx:GridRow>
								<mx:GridItem width="182">
									<s:Label text="年份设置" styleName="myLabel"/>
									<s:NumericStepper id="rws02" width="110" maximum="2100" minimum="2019" stepSize="1"/>
									<s:Label text="*" styleName="must myLabel"/>
								</mx:GridItem>
								<mx:GridItem>
									<s:Label text="年度任务数" styleName="myLabel"/>
									<s:TextInput id="rws07" width="128" restrict="0-9"/>
									<s:Label text="*" styleName="must myLabel"/>
								</mx:GridItem>
								<mx:GridItem>
									<s:Label text="机构名称" styleName="myLabel"/>
									<s:DropDownList id="rws05" enabled="false"  width="166"/>
									<s:Label text="*" styleName="must myLabel"/>
								</mx:GridItem>
							</mx:GridRow>
						</mx:Grid>
					</s:NavigatorContent>
				</mx:TabNavigator>
				
				<mx:TabNavigator chromeColor="#ffffff" creationPolicy="all" width="100%" paddingBottom="7">
					<s:NavigatorContent  label="录入信息">
						<s:VGroup width="660">
							<mx:Grid width="669" paddingLeft="10">
								
								<mx:GridRow>
									
									<mx:GridItem>
										<s:Label styleName="myLabel" text="录入人员"/>
										<component:FindSelectedItemComboBox id="rws09" width="110" height="22"
																			editable="true" restrict="^0-9"/>
										<s:Label text="*" styleName="must myLabel"/>
										
									</mx:GridItem>
									<mx:GridItem>
										<s:Label styleName="myLabel" text="录 入 时  间"/>
										<component:CustomRangeDateField id="rws10" enabled="false"
																		isSelectNow="true"/>
										<s:Label  styleName="must myLabel" text="*"/>
										
									</mx:GridItem>
									<mx:GridItem width="247">
										<s:Label styleName="myLabel" text="录入单位"/>
										<s:DropDownList id="rws08" enabled="false"  width="166"/>
										<s:Label text="*" styleName="must myLabel"/>
										
									</mx:GridItem>
									
								</mx:GridRow>
							</mx:Grid>
						</s:VGroup>
					</s:NavigatorContent>
				</mx:TabNavigator>
			</s:VGroup>
			
			<s:HGroup width="100%"  horizontalAlign="center">
				<s:Button label="保存" click="save_clickHandler(event)" id="save"/>
			</s:HGroup>  
			
		</s:VGroup>  
		
	</s:Scroller>
</s:TitleWindow>
