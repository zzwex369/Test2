package com.xyw.sys.flex.session.interceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.aopalliance.intercept.MethodInterceptor;
import org.aopalliance.intercept.MethodInvocation;

import com.xyw.sys.constant.SystemConstant;
import com.xyw.sys.flex.session.context.AMFContext;
import com.xyw.sys.model.SessionException;
import com.xyw.sys.model.SystemUser;

public class FlexSessionInterceptor implements MethodInterceptor {

	@Override
	public Object invoke(MethodInvocation methodInvocation) throws Throwable {
		AMFContext amfContext = AMFContext.getCurrentAMFContext();
		HttpServletRequest httpServletRequest = amfContext.getHttpServletRequest();
		HttpSession httpSession = httpServletRequest.getSession();
		SystemUser systemUser = (SystemUser)httpSession.getAttribute(SystemConstant.LOGIN_USER_INFO);
		if(systemUser == null) {
			throw new SessionException(SystemConstant.LOGIN_USER_INFO_IS_NULL, "Session 超时, 请重新登录!");
		}
		return methodInvocation.proceed();
	}

}