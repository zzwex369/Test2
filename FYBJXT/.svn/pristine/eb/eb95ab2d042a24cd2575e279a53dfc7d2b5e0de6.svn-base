<?xml version="1.0" encoding="utf-8"?>
<s:HGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx="library://ns.adobe.com/flex/mx"
		  verticalAlign="middle" horizontalAlign="center"
		  creationComplete="hgroupCreationCompleteHandler(event)">
	<fx:Declarations>
		<s:RemoteObject id="systemService" destination="systemService" endpoint="{this.parentApplication.contextRoot}/messagebroker/amf" showBusyCursor="true">
			<s:method name="getCustomAreaComboBoxData" result="getCustomAreaComboBoxDataHandler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.xyw.sys.event.CustomAreaCityEvent;
			import com.xyw.sys.event.CustomAreaCountyEvent;
			import com.xyw.sys.event.CustomAreaTownEvent;
			import com.xyw.sys.model.AreaRequest;
			import com.xyw.sys.model.AreaResponse;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			
			import spark.events.IndexChangeEvent;
			
			private var areaRequest:AreaRequest = null;
			
			[Bindable]
			public var areaCode:String = "";
			
			[Bindable]
			public var table:String = null;
			
			
			private function hgroupCreationCompleteHandler(event:FlexEvent):void
			{
				if(!areaCode)
				{
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode,"province",true);//省
					
					this.province.selectedIndex = 0;
					this.city.selectedIndex = 0;
					this.county.selectedIndex = 0;
					this.town.selectedIndex = 0;
					this.country.selectedIndex = 0;
				}else 
					this.setAreaCode(areaCode);
			}
			
			public function setAreaCode(areaCode:String):void
			{
			
				//省级
				if(areaCode.length == 2) {
					
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode,"province",true);//省
					
				}
				//市级
				if(areaCode.length == 4) {
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode,"province",true);//省

					getCustomAreaComboBoxData(areaCode.substr(0,2),"city");//市
					
					getCustomAreaComboBoxData(areaCode,"city",true);//县
					
				}
				//县级
				if(areaCode.length == 6) {
					
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode.substr(0, 2),"city");//市
					
					getCustomAreaComboBoxData(areaCode.substr(0, 4),"city",true);//市
					//getCustomAreaComboBoxData(areaCode,"county");//县
						
					getCustomAreaComboBoxData(areaCode,"county",true);//县
	
				}
				//乡镇级
				if(areaCode.length == 9){
					
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode.substr(0, 2),"city");//市
					
					getCustomAreaComboBoxData(areaCode.substr(0, 4),"city",true);//市
										
					getCustomAreaComboBoxData(areaCode.substr(0, 6),"county",true);//县
					
					getCustomAreaComboBoxData(areaCode.substr(0, 6),"town");//县
					
					getCustomAreaComboBoxData(areaCode.substr(0, 9),"town",true);//县
					
					
				}
				
				//村级
				if(areaCode.length == 12){
					
					getCustomAreaComboBoxData("defaultValue","province");//省
					
					getCustomAreaComboBoxData(areaCode.substr(0, 2),"city");//市
					
					getCustomAreaComboBoxData(areaCode.substr(0, 4),"county");//县
					
					getCustomAreaComboBoxData(areaCode.substr(0, 6),"town");//县
					
					getCustomAreaComboBoxData(areaCode.substr(0, 9),"country");//村
					
					
				}
				this.areaCode=areaCode;
				this.province.selectedIndex = 0;
				this.city.selectedIndex = 0;
				this.county.selectedIndex = 0;
				this.town.selectedIndex = 0;
				this.country.selectedIndex = 0;
				//this.group.selectedIndex = 0;
			}
			
			
			public function getAreaName():String{
				var areaName:String = null;
				try{
					if(province.selectedItem.data!=""){
						areaName=province.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(city.selectedItem.data!=""){
						areaName+=city.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(county.selectedItem.data!=""){
						areaName+=county.selectedItem.label;
					}
				}catch(e:Error){}
				try{
					if(town.selectedItem.data!=""){
						areaName+=town.selectedItem.label;
					}
				}catch(e:Error){}
				/*
				try{
				if(country.selectedItem.data!=""){
				areaName+=country.selectedItem.label;
				}
				}catch(e:Error){}
				try {
				if(this.group.selectedItem.data != "") {
				areaName+=group.selectedItem.label;
				}
				}catch(e:Error){}
				*/
				return areaName;
			}
			
			private function provinceDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var provinceData:String = DropDownList(event.target).selectedItem.data;
				this.areaCode=provinceData;
				getCustomAreaComboBoxData(provinceData,"province",true);
			}
			
			
			private function cityDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var cityData:String = DropDownList(event.target).selectedItem.data;
				this.areaCode=cityData;
				getCustomAreaComboBoxData(cityData,"city",true);
				
			}
			
			private function countyDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var countyData:String = DropDownList(event.target).selectedItem.data;
				this.areaCode=countyData;
				getCustomAreaComboBoxData(countyData,"county",true);
				
			}
			
			private function townDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var townData:String = DropDownList(event.target).selectedItem.data;
				this.areaCode=townData;
				getCustomAreaComboBoxData(townData,"town",true);
				
			}
			
			private function countryDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				var groupData:String = DropDownList(event.target).selectedItem.data;
				getCustomAreaComboBoxData(groupData,"country",true);
				
			}
			
			private function commityDropDownListIndexChangeHandler(event:IndexChangeEvent):void
			{
				
			}
			
			private function getCustomAreaComboBoxDataHandler(event:ResultEvent):void
			{
				var areaResponse:Object = event.result;
				var areaFlag:String = areaResponse.areaFlag;
				var showPrompt:Boolean = areaResponse.showPrompt;
				var comboBoxDataList:ArrayCollection = areaResponse.comboBoxDataList;
				if(areaFlag == "province") {
					if(showPrompt) {
						this.city.dataProvider = comboBoxDataList
						this.city.selectedIndex = 0;
						this.county.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.county.selectedIndex = 0;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.selectedIndex = 0;
					} else {
						this.province.dataProvider = comboBoxDataList;
						//comboBoxDataList.addItemAt({label:"选择", data:""}, 0);
						this.province.selectedIndex = 0;
						if(this.areaCode != "") {
							this.province.selectedIndex = CompMethod.getDropDownListSelectedIndex(new ArrayCollection(this.province.dataProvider.toArray()), this.areaCode.substr(0, 2));
						}
						this.city.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.city.selectedIndex = 0;
						this.county.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.county.selectedIndex = 0;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.selectedIndex = 0;
					}
				} else if(areaFlag == "city") {
					if(showPrompt) {
						this.county.dataProvider = comboBoxDataList;
						this.county.selectedIndex = 0;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
					} else {
						this.city.dataProvider = comboBoxDataList;
						this.city.selectedIndex = 0;
						if(this.areaCode != "") {
							this.city.selectedIndex = CompMethod.getDropDownListSelectedIndex(new ArrayCollection(this.city.dataProvider.toArray()), this.areaCode.substr(0, 4));
						}
						this.county.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);						
					}
					this.town.selectedIndex = 0;
					this.country.selectedIndex = 0;
				} else if(areaFlag == "county") {
					if(showPrompt) {
						this.town.dataProvider = comboBoxDataList;
						this.town.selectedIndex = 0;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.selectedIndex = 0;
					} else {
						this.county.dataProvider = comboBoxDataList;
						this.county.selectedIndex = 0;
						this.town.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
					}
						if(this.areaCode != "") 
							this.county.selectedIndex = CompMethod.getDropDownListSelectedIndex(new ArrayCollection(this.county.dataProvider.toArray()), this.areaCode.substr(0, 6));
				} else if(areaFlag == "town") {
					if(showPrompt) {
						this.country.dataProvider = comboBoxDataList;
						this.country.selectedIndex = 0;
					} else {	
						this.town.dataProvider = comboBoxDataList;
						this.country.dataProvider = new ArrayCollection([{label:"选择", data:""}]);
						this.town.selectedIndex = 0;
						if(this.areaCode != "") {
							this.town.selectedIndex = CompMethod.getDropDownListSelectedIndex(new ArrayCollection(this.town.dataProvider.toArray()), this.areaCode.substr(0, 9));
						}
					}
				}else if(areaFlag == "country"){
					if(showPrompt) {
						
					} else {
						this.country.dataProvider = comboBoxDataList;
						this.country.selectedIndex = 0;
						if(this.areaCode != "") {
							this.country.selectedIndex = CompMethod.getDropDownListSelectedIndex(new ArrayCollection(this.country.dataProvider.toArray()), this.areaCode.substr(0,12));
						}
					}
					
				} 
			}
			
			public function getAreaCode():String
			{
				var areaCode:String = null;
				if(this.city.selectedItem.data == "") {
					areaCode = 	this.province.selectedItem.data;
					return areaCode;
				} else if(this.county.selectedItem.data == "") {
					areaCode = 	this.city.selectedItem.data;
					return areaCode;
				} else if(this.town.selectedItem.data == "") {
					areaCode = 	this.county.selectedItem.data;
					return areaCode;
				} else if(this.country.selectedItem.data == ""){
					areaCode = 	this.town.selectedItem.data;
					return areaCode;
				} else {
					areaCode = this.country.selectedItem.data;
					return areaCode;
				}
				
				return null;
				
				/*
				 else if(this.group.selectedItem.data == ""){
				areaCode = this.country.selectedItem.data;
				return areaCode;
				} else {
				areaCode = this.group.selectedItem.data;
				return areaCode;
				}
				*/
			}
			
			public function getAreaType():String
			{
				var areaType:String = "";
				if(this.town.selectedItem.data != "")
				{
					areaType = "8";
				}else if(this.county.selectedItem.data != "")
				{
					areaType = "6";
				}else if(this.city.selectedItem.data != "")
				{
					areaType = "4";
				}else if(this.province.selectedItem.data != "")
				{
					areaType = "2";
				}
				return areaType;
			}
			
			private function getCustomAreaComboBoxData(areaCode:String,areaFlag:String,showPrompt:Boolean=false):void
			{
				this.areaRequest = new AreaRequest();
				this.areaRequest.table=table;
				this.areaRequest.areaCode = areaCode;
				this.areaRequest.showPrompt = showPrompt;
				this.areaRequest.areaFlag = areaFlag;
				this.systemService.getCustomAreaComboBoxData(areaRequest);//省
			}
			
		]]>
	</fx:Script>
	<s:Label text="省" width="15"/><s:DropDownList id="province" width="100%" change="provinceDropDownListIndexChangeHandler(event)"/>
	<s:Label text="市" width="15"/><s:DropDownList id="city" width="100%" change="cityDropDownListIndexChangeHandler(event)"/>
	<s:Label text="县区" width="30"/><s:DropDownList id="county" width="100%" change="countyDropDownListIndexChangeHandler(event)"/>
	<s:Label text="乡镇" width="30"/><s:DropDownList id="town" width="100%" change="townDropDownListIndexChangeHandler(event)"/>
	<s:Label text="村" width="15"/><s:DropDownList id="country" width="100%"/>
	<!--<s:Label text="组"/><s:DropDownList id="group" width="150"/>-->
	
</s:HGroup>