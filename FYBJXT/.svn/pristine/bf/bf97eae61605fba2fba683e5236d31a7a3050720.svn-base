<?xml version="1.0" encoding="utf-8"?>
<s:VGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		xmlns:gja="com.xyw.module.msss.la.fngjadacx.*"
		creationComplete="init()"
		width="100%" height="100%" >
	<fx:Declarations>
		
		<s:RemoteObject id="l302Service" destination="l302Service"
						endpoint="{this.parentApplication.contextRoot}/messagebroker/amf"
						showBusyCursor="true">
			<s:method name="saveL302" result="saveOrRenewL302Handler(event)"/>
			<s:method name="renewL302" result="saveOrRenewL302Handler(event)"/>
		</s:RemoteObject>
	</fx:Declarations>
	<fx:Metadata>
		[Event(name="saveSuccess", type="flash.events.Event")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import com.xyw.module.msss.la.model.L302;
			import com.xyw.module.msss.la.model.L302Request;
			import com.xyw.module.msss.la.model.VL302;
			import com.xyw.sys.custom.component.CompMethod;
			import com.xyw.sys.event.CustomDataEvent;
			import com.xyw.sys.model.ComboBoxDataRequest;
			import com.xyw.sys.model.SystemUser;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			import mx.utils.StringUtil;
			private var l302:L302;
			public  var l30202:String;
			public var l30204:String;
			private var comboBoxDataRequest:ComboBoxDataRequest;
			private var systemUser:SystemUser;
			public var state:String;
			public var vl302:VL302;
			private function init():void
			{
				
				systemUser=this.parentApplication.systemUser;
				if("0"==state)
					callLater(updatehpv);
			}
		
			private function updatehpv():void
			{
				L302_65.text=vl302.l30265;
				check.checker.text=vl302.l30269;
				CompMethod.setRadioButtonSelect(L302_62,vl302.l30262);
				CompMethod.setRadioButtonSelect(L302_63,vl302.l30263);
				CompMethod.setRadioButtonSelect(L302_66,vl302.l30266);
				CompMethod.setRadioButtonSelect(L302_67,vl302.l30267);
				CompMethod.setCheckBoxAutomationName(L302_64,vl302.l30264);

			
			}
			private function verification():Boolean
			{
				
				var l30264Arr:Array=CompMethod.getCheckBoxAutomationName(L302_64);
				if(L302_63_01.selected&&!l30264Arr[0])
				{
					Alert.show("请选择HPV类型","系统提示");
					return false;
				}
				if(L302_65.enabled&&!L302_65.text)
				{
					Alert.show("请输入其他类型","系统提示");
					return false;
				}
				if(L302_66_01.selected&&!l302.l30267)
				{
					Alert.show("请选择检查类型 ","系统提示");
					return false;
				}
				if(!check.checker.text)
				{
					Alert.show("请输入检查人员信息","系统提示");
					return false;
				}
				save.enabled=false;
				l302.l30264=l30264Arr[1];
				return true;
			}

			/**
			 *
			 */
			private function saveHPV():void
			{
				l302=new L302();
				l302.l30267=CompMethod.getRadioButtonValue(L302_67);
				
				if(!verification())
					return ;
				
				
				l302.l30265=StringUtil.trim(L302_65.text);
				l302.l30269=StringUtil.trim(check.checker.text);
				l302.l30262=CompMethod.getRadioButtonValue(L302_62);
				l302.l30263=CompMethod.getRadioButtonValue(L302_63);
				l302.l30266=CompMethod.getRadioButtonValue(L302_66);
				l302.l30268=check.institutionCode.selectedItem.data;
				l302.l30270=DateField.stringToDate(check.nowDate.text,"YYYY-MM-DD");
				
				var l302Request:L302Request=new L302Request();
				l302Request.flag="2";
				if("0"==state)
				{
					l302.l30201=vl302.l30201;
					l302Request.l302=l302;
					l302Service.renewL302(l302Request);
				}else
				{	
					l302.l30202=l30202;
					l302Request.l302=l302;
					l302Service.saveL302(l302Request);
				}
			}
			
			private function saveOrRenewL302Handler(event:ResultEvent):void
			{
				var l302Response:Object=event.result;
				if(l302Response.state)
				{
					Alert.show("0"==state?"修改成功":"保存成功！","系统提示",1,this,closeHandler);
					return ;
				}
				save.enabled=true;
				Alert.show(l302Response.errorMessage,"系统提示");
			}
			
			/**
			 *
			 */
			private function closeHandler(event:CloseEvent):void
			{
				if(event.detail==1)
					this.dispatchEvent(new Event("saveSuccess"));
			}
			
			
			
			private function check_customDataHandler(event:CustomDataEvent):void
			{
				if('1'==state)
					check._initializeComboBox('2');
				else
				{
					if(!check.nowDate.text)
						callLater(check_customDataHandler,[null]);
					else
					{
						check.nowDate.text=vl302.l30270str;
						check.institutionCode.selectedIndex=CompMethod.getDropDownListSelectedIndex(check.institutionCode.dataProvider,vl302.l30268);

					}
				}
					
			}
			
		]]>
	</fx:Script>
	<s:Scroller x="-6" y="1" width="100%" height="100%" horizontalScrollPolicy="auto"
				verticalScrollPolicy="auto">
		<s:VGroup paddingBottom="20" paddingLeft="10" paddingRight="10" paddingTop="10">
			<mx:TabNavigator width="850" chromeColor="#ffffff" creationPolicy="all">
				<s:NavigatorContent width="100%" label="HPV检查">
					<s:VGroup paddingBottom="2" paddingLeft="10" paddingRight="10">	
						<s:HGroup width="100%" height="100%" paddingBottom="5" verticalAlign="middle">
							<s:Label width="87" text="HPV检查"/>
							<s:HGroup width="100%" height="100%" paddingBottom="3" verticalAlign="middle" id="L302_62">
								<s:RadioButton label="1.阴性" groupName="L302_62" selected="true" buttonMode="true" width="60" id="L302_62_01"
											   change="CompMethod.hasNumEles([L302_63,L302_64])" value="1"/>
								<s:RadioButton label="2.阳性" groupName="L302_62" buttonMode="true" width="60" id="L302_62_02" value="2"
											   change="L302_63_01.selected=true"/>
							</s:HGroup>
							<s:HGroup width="100%" height="100%" verticalAlign="middle" paddingLeft="20">
								<s:HGroup width="100%" height="100%" paddingBottom="3" verticalAlign="middle" id="L302_63">
									<s:RadioButton label="1.HPV亚型" groupName="L302_63"  width="90" id="L302_63_01" enabled="{L302_62_02.selected}" value="1"/>
									<s:RadioButton label="2.未分型" groupName="L302_63" width="75"  id="L302_63_02" enabled="{L302_62_02.selected}" change="CompMethod.hasNumEles(L302_64)" value="2"/>
								</s:HGroup>
								<s:HGroup width="100%" height="100%" verticalAlign="baseline" id="L302_64" enabled="{L302_63_01.selected}">
									<s:Label text="HPV亚型选择"/>
									<s:CheckBox automationName="1" label="16/18" buttonMode="true"/>
									<s:CheckBox automationName="9" label="其他" buttonMode="true" id="L302_64_2" change="if(!L302_64_2.selected)L302_65.text=''"/>
									<s:TextInput width="130" id="L302_65" enabled="{L302_64_2.selected}"/>
								</s:HGroup>  
								
								
							</s:HGroup>
						</s:HGroup>
						<s:HGroup width="100%" height="100%" paddingBottom="5" verticalAlign="middle">
							<s:Label width="87" text="需进一步检查"/>
							<s:HGroup width="100%" height="100%" paddingBottom="3" verticalAlign="middle" id="L302_66">
								<s:RadioButton label="1.是" groupName="L302_66"  width="60" buttonMode="true" id="L302_66_01" value="1"
											   change="L302_67_1.selected=true"/>
								<s:RadioButton label="2.否" groupName="L302_66" selected="true" width="58" buttonMode="true" id="L302_66_02" value="2"
											   change="CompMethod.hasNumEles(L302_67)"/>
								<s:HGroup width="100%" height="100%" verticalAlign="middle" paddingLeft="20">
									<s:Label text="检查类型"/>
									<s:HGroup width="130" id="L302_67" gap="50" enabled="{L302_66_01.selected}" >
										<s:RadioButton value="1" label="宫颈细胞学" groupName="L302_67" id="L302_67_1"/>
										<s:RadioButton value="2" label="VIA/VILI" groupName="L302_67"/>
										<s:RadioButton value="3" label="阴道镜" groupName="L302_67"/>
									</s:HGroup>
								</s:HGroup>
							</s:HGroup>
						</s:HGroup>
					</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
			<gja:gjajcdj width="850" chromeColor="#ffffff" creationPolicy="all" id="check" 
						 customData="check_customDataHandler(event)"/>
			<s:HGroup width="850" height="30" contentBackgroundColor="#FF0000" horizontalAlign="center"
					  paddingBottom="20" paddingLeft="10" paddingTop="10" verticalAlign="middle">
				<s:Button label="保存" buttonMode="true" id="save" click="saveHPV()"/>
			</s:HGroup>
		</s:VGroup>
	</s:Scroller>
</s:VGroup>
