<?xml version="1.0" encoding="utf-8"?>
<s:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
			   xmlns:s="library://ns.adobe.com/flex/spark"
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   xmlns:hi="http://hi.csdn.net/To9m"
			   xmlns:component="com.xyw.sys.custom.component.*"
			   backgroundColor="white" chromeColor="#5CACEE"
			   close="removeWindow()" cornerRadius="5" creationComplete="putRecord()"
			   skinClass="com.xyw.sys.custom.skin.CustomTitleWindow"
			   title="孕产妇转诊单">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		@namespace skin "com.xyw.sys.custom.skin.*";
		.textInput{
			skinClass:ClassReference("com.xyw.sys.custom.skin.CustomTextInputSkin");
		}
	</fx:Style>
	<fx:Script>
		<![CDATA[
			import com.xyw.sys.custom.component.CompMethod;
			
			import mx.controls.DateField;
			import mx.core.UIComponent;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			import mx.printing.FlexPrintJob;
			import mx.printing.FlexPrintJobScaleType;
			
			import spark.components.RadioButton;
			[Bindable]
			public var vf310:Object;
			[Bindable]
			private var rowVGroup:int =1;
			private var f310Arr:Array;
			private var str:String='';
			private var _length:int;
			private function removeWindow():void
			{
				PopUpManager.removePopUp(this);
			}
			private function putRecord():void
			{	
				
				age.text=CompMethod._getAge(F310_04.text); 
				callLater(addRow);
			}
			
			
			private function printF308():void
			{
				var flexPrintJob:FlexPrintJob = new FlexPrintJob();
				flexPrintJob.printAsBitmap = false;
				if(flexPrintJob.start())
				{
					flexPrintJob.addObject(this.data,FlexPrintJobScaleType.MATCH_WIDTH);
					flexPrintJob.send();
				}
				
			}
			 
			protected function jz_enterStateHandler(event:FlexEvent):void
			{
				f310Arr=vf310.f31013.toString().split("!");
				getF310ArrChild();
				 var index:int=(Number(vf310.f31014))-1;
				 (hgroup.getElementAt(index) as CheckBox).selected=true;
				 Doctorname.text=vf310.f31015;
				 institution.text=vf310.f31017zh;
				 time.text=DateField.dateToString(vf310.f31016,'YYYY-MM-DD');
			}
			
			protected function zz_enterStateHandler(event:FlexEvent):void
			{
				f310Arr=vf310.f31009.toString().split("!");
				getF310ArrChild();
				Doctorname.text=vf310.f31010;
				institution.text=vf310.f31012zh;
				time.text=DateField.dateToString(vf310.f31011,'YYYY-MM-DD');
				
			}
			
			
			private function getF310ArrChild():void
			{
				f310Arr.pop();
				for(var i:int=0;i<f310Arr.length;i++)
				{
					refresh(f310Arr[i].toString());
				}
				
			}
			
			/**
			 *重新组合字符串排列方式
			 */
			private function refresh(f309Str:String):String
			{
				
				if(f309Str.length>41)
				{
					var str1:String=f309Str.substring(0,41)+"!";
					var str2:String=f309Str.substring(41,f309Str.length); 
					str+=str1;
					if(str2.length>41)
					{	
						refresh(str2);
					}else
						str+=(str2+"!");
					
				}else 
					str+=(f309Str+"!");
				return str;
			}
			
			/**
			 *添加行
			 */
			private function addRow():void
			{
				f310Arr=str.split("!");
				_length=(f310Arr.length)-2;
				rowVGroup=++_length;
				for(var i:int=0;i<_length;i++)
				{
					if(rowVGroup!=vgroup.numElements)
					{
						vgroup.height+=19;
						data.height+=19;
						var text:TextInput=new TextInput();
						text.width=vgroup.getElementAt(0).width;
						text.styleName='textInput';
						text.setStyle("height",15);
						text.editable=false;
						vgroup.addElementAt(text,vgroup.numElements);				
					}
					var textInput:Object=vgroup.getElementAt(i);
					textInput.text=f310Arr[i]; 
				}
			}
			
			
		]]>
	</fx:Script>
	<s:states>
		<s:State name="zz" enterState="zz_enterStateHandler(event)"/>
		<s:State name="jz" enterState="jz_enterStateHandler(event)"/>
	</s:states>
	<s:VGroup  paddingBottom="10">
	<s:VGroup width="568" horizontalAlign="center" gap="10"  paddingBottom="10" id="data"  >
		<s:HGroup width="100%">
			<s:Label width="100%"  textAlign="center" paddingTop="35"  fontSize="20"  paddingBottom="5"
					 text.zz="妊娠风险筛查阳性孕产妇转诊单"
					 text.jz="妊娠风险筛查阳性孕产妇接诊单"/>
		</s:HGroup>
		<mx:Grid verticalGap="10" horizontalGap="1" verticalAlign="middle" horizontalAlign="center">
			<mx:GridRow>
				<mx:GridItem>
					<s:Label  text="姓       名：" paddingLeft="5" width="100%"  textAlign="center"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="F310_03" text="{vf310.f31003}"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label width="100%"  textAlign="center" text="出生日期："/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="F310_04" text="{DateField.dateToString(vf310.f31004,'YYYY-MM-DD')}"/>
				</mx:GridItem>	
				<mx:GridItem >
					<s:Label width="100%"  textAlign="center" text="年       龄："/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="age" />
					<s:Label   text="（周岁）"/>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow>
				<mx:GridItem >
					<s:Label width="100%" textAlign="center" text="孕       周：" paddingLeft="5"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="F310_08" text="{vf310.f31008}"/>
					<s:Label   text="（周）"/>
				</mx:GridItem>	
				<mx:GridItem>
					<s:Label width="100%"  textAlign="center" text="联系电话："/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="F310_07" text="{vf310.f31007}"/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label width="100%" textAlign="center" text="证件号码："/>
				</mx:GridItem>
				<mx:GridItem>
					<s:Label   id="F310_06" text="{vf310.f31006}"/>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow>
				<mx:GridItem colSpan="6">
					<s:Label  textAlign="center" text="筛查结果（主要危险因素）："  paddingLeft="8"/>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow>
				<mx:GridItem colSpan="6" paddingLeft="8">
					<s:VGroup id="vgroup" width="100%">
						<s:TextInput width="100%"  styleName="textInput"/>
					</s:VGroup>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow includeIn="jz">
				<mx:GridItem colSpan="6">
					<s:Label  paddingLeft="8" text="妊娠风险评估分级（请在相关项目上打勾）："/>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow includeIn="jz">
				<mx:GridItem colSpan="6">
					<s:HGroup  id="hgroup" chromeColor="#FFFFFF" gap="75" horizontalAlign="center" verticalAlign="middle" paddingLeft="8">
						<s:CheckBox label="绿色" mouseEnabled="false"/>
						<s:CheckBox label="黄色" mouseEnabled="false"/>
						<s:CheckBox label="橙色" mouseEnabled="false"/>
						<s:CheckBox label="红色" mouseEnabled="false"/>
						<s:CheckBox label="紫色" mouseEnabled="false"/>
					</s:HGroup>
				</mx:GridItem>
			</mx:GridRow>
			<mx:GridRow>
				<mx:GridItem colSpan="4">
					<s:Label text="医生签名：" width="100%" textAlign="right"/>
				</mx:GridItem>
				<mx:GridItem colSpan="2">
					<s:Label width="100%" id="Doctorname"  styleName="myLabel"/>
				</mx:GridItem>
			</mx:GridRow>	
			<mx:GridRow>
				<mx:GridItem colSpan="4">
					<s:Label text.jz="接诊机构："  text.zz="转诊机构：" width="100%" textAlign="right"/>
				</mx:GridItem>
				<mx:GridItem colSpan="2">
					<s:Label width="100%" id="institution" styleName="myLabel"/>
				</mx:GridItem>
			</mx:GridRow>	
			<mx:GridRow>
				<mx:GridItem colSpan="4">
					<s:Label text.jz="接诊日期："  text.zz="转诊日期：" width="100%" textAlign="right"/>
				</mx:GridItem>
				<mx:GridItem colSpan="2">
					<s:Label width="100%"  id="time" styleName="myLabel"/>
				</mx:GridItem>
			</mx:GridRow>	
		</mx:Grid>
	</s:VGroup>
		<s:HGroup id="print" horizontalAlign="right" width="100%" paddingRight="20" buttonMode="true">
			<s:Button click="printF308()" label="打印" cornerRadius="5" chromeColor="0XFFFFFF"/>
		</s:HGroup>
	</s:VGroup>
</s:TitleWindow>
